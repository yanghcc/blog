<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>zepto 源码解读 | icetower</title>
    <meta name="description" content="anglo&#96;s blog">
    <link rel="icon" href="/blog/document.png">
    
    <link rel="preload" href="/blog/assets/css/0.styles.98372b78.css" as="style"><link rel="preload" href="/blog/assets/js/app.bae4038b.js" as="script"><link rel="preload" href="/blog/assets/js/38.f6e289a7.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.350d8323.js"><link rel="prefetch" href="/blog/assets/js/11.95e2312a.js"><link rel="prefetch" href="/blog/assets/js/12.7ddae409.js"><link rel="prefetch" href="/blog/assets/js/13.e0928b5b.js"><link rel="prefetch" href="/blog/assets/js/14.0716d39f.js"><link rel="prefetch" href="/blog/assets/js/15.33598b62.js"><link rel="prefetch" href="/blog/assets/js/16.1219e179.js"><link rel="prefetch" href="/blog/assets/js/17.ab548388.js"><link rel="prefetch" href="/blog/assets/js/18.768f4e4f.js"><link rel="prefetch" href="/blog/assets/js/19.b8112a7a.js"><link rel="prefetch" href="/blog/assets/js/2.370b5d4a.js"><link rel="prefetch" href="/blog/assets/js/20.3a75cd43.js"><link rel="prefetch" href="/blog/assets/js/21.0b3a5483.js"><link rel="prefetch" href="/blog/assets/js/22.67d7e333.js"><link rel="prefetch" href="/blog/assets/js/23.6be9b585.js"><link rel="prefetch" href="/blog/assets/js/24.f5d45aef.js"><link rel="prefetch" href="/blog/assets/js/25.acd8bcfc.js"><link rel="prefetch" href="/blog/assets/js/26.c926a6ed.js"><link rel="prefetch" href="/blog/assets/js/27.6ef2cb8c.js"><link rel="prefetch" href="/blog/assets/js/28.2e877e2c.js"><link rel="prefetch" href="/blog/assets/js/29.b23cbcf0.js"><link rel="prefetch" href="/blog/assets/js/3.b2097593.js"><link rel="prefetch" href="/blog/assets/js/30.a385b249.js"><link rel="prefetch" href="/blog/assets/js/31.5d531805.js"><link rel="prefetch" href="/blog/assets/js/32.14daae88.js"><link rel="prefetch" href="/blog/assets/js/33.00deed18.js"><link rel="prefetch" href="/blog/assets/js/34.7e88fa31.js"><link rel="prefetch" href="/blog/assets/js/35.269d5a9a.js"><link rel="prefetch" href="/blog/assets/js/36.199b7575.js"><link rel="prefetch" href="/blog/assets/js/37.ca0d3fea.js"><link rel="prefetch" href="/blog/assets/js/39.4664880a.js"><link rel="prefetch" href="/blog/assets/js/4.65f70785.js"><link rel="prefetch" href="/blog/assets/js/40.18cad931.js"><link rel="prefetch" href="/blog/assets/js/41.3bafdef9.js"><link rel="prefetch" href="/blog/assets/js/42.f54e2f5f.js"><link rel="prefetch" href="/blog/assets/js/43.12ab04d7.js"><link rel="prefetch" href="/blog/assets/js/44.0d5ebaf3.js"><link rel="prefetch" href="/blog/assets/js/45.1cb3daeb.js"><link rel="prefetch" href="/blog/assets/js/5.7b3df2a9.js"><link rel="prefetch" href="/blog/assets/js/6.876be49e.js"><link rel="prefetch" href="/blog/assets/js/7.b58748c4.js"><link rel="prefetch" href="/blog/assets/js/8.8d44e0b5.js"><link rel="prefetch" href="/blog/assets/js/9.a6e6d0e8.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.98372b78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">icetower</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">home</a></div><div class="nav-item"><a href="/blog/note/summary.html" class="nav-link">summary</a></div><div class="nav-item"><a href="/blog/about.html" class="nav-link">about</a></div><div class="nav-item"><a href="http://blog.icetower.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://www.icetower.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  news
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://music.icetower.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  music
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/yanghcc/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  repo-blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/yanghcc?tab=stars" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github-star
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/yanghcc/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">home</a></div><div class="nav-item"><a href="/blog/note/summary.html" class="nav-link">summary</a></div><div class="nav-item"><a href="/blog/about.html" class="nav-link">about</a></div><div class="nav-item"><a href="http://blog.icetower.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://www.icetower.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  news
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="http://music.icetower.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  music
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">github</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/yanghcc/blog" target="_blank" rel="noopener noreferrer" class="nav-link external">
  repo-blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/yanghcc?tab=stars" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github-star
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <a href="https://github.com/yanghcc/blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>🚀 Getting started</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/blog/note/" class="sidebar-link">note</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/#通过github添加数据" class="sidebar-link">通过github添加数据</a></li></ul></li><li><a href="/blog/note/glob.html" class="sidebar-link">glob简介</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/note/reg.html" class="sidebar-link">Regular</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/note/bit-opration.html" class="sidebar-link">位运算符</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/bit-opration.html#js中常用的7个位运算符" class="sidebar-link">JS中常用的7个位运算符</a></li><li class="sidebar-sub-header"><a href="/blog/note/bit-opration.html#位运算符在js中的妙用" class="sidebar-link">位运算符在js中的妙用</a></li></ul></li><li><a href="/blog/note/crypto.html" class="sidebar-link">crypto</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/note/fragmentation.html" class="sidebar-link">阅读整理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/fragmentation.html#subtile" class="sidebar-link">subtile</a></li></ul></li><li><a href="/blog/note/git.html" class="sidebar-link">git clone克隆或下载一个仓库单个文件夹</a></li><li><a href="/blog/note/html.html" class="sidebar-link">html笔记</a></li><li><a href="/blog/note/nginx.html" class="sidebar-link">nginx常用配置</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/nginx.html#简介" class="sidebar-link">简介</a></li></ul></li><li><a href="/blog/note/git.html" class="sidebar-link">git clone克隆或下载一个仓库单个文件夹</a></li><li><a href="/blog/note/remind.html" class="sidebar-link">备忘录</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/remind.html#_2018-04-18" class="sidebar-link">2018-04-18</a></li></ul></li><li><a href="/blog/note/md-sytax.html" class="sidebar-link">Markdown常用语法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/md-sytax.html#标题" class="sidebar-link">标题</a></li><li class="sidebar-sub-header"><a href="/blog/note/md-sytax.html#二级标题" class="sidebar-link">二级标题</a></li><li class="sidebar-sub-header"><a href="/blog/note/md-sytax.html#列表" class="sidebar-link">列表</a></li><li class="sidebar-sub-header"><a href="/blog/note/md-sytax.html#引用" class="sidebar-link">引用</a></li><li class="sidebar-sub-header"><a href="/blog/note/md-sytax.html#图片与链接" class="sidebar-link">图片与链接</a></li><li class="sidebar-sub-header"><a href="/blog/note/md-sytax.html#粗体和斜体-粗体-斜体" class="sidebar-link">粗体和斜体 粗体 斜体</a></li><li class="sidebar-sub-header"><a href="/blog/note/md-sytax.html#表格" class="sidebar-link">表格</a></li><li class="sidebar-sub-header"><a href="/blog/note/md-sytax.html#分割线-三个" class="sidebar-link">分割线 三个*</a></li></ul></li><li><a href="/blog/note/reg.html" class="sidebar-link">Regular</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/note/npm.html" class="sidebar-link">npm 常用模块</a></li><li><a href="/blog/note/optimization.html" class="sidebar-link">常用优化整理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/optimization.html#性能优化" class="sidebar-link">性能优化</a></li><li class="sidebar-sub-header"><a href="/blog/note/optimization.html#使用-raf（requestanimationframe）触发滚动事件" class="sidebar-link">使用 rAF（requestAnimationFrame）触发滚动事件</a></li></ul></li><li><a href="/blog/note/todo.html" class="sidebar-link">TODO</a></li><li><a href="/blog/note/uuid.html" class="sidebar-link">javascript生成UUID方案</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/uuid.html#uuid简介" class="sidebar-link">UUID简介</a></li></ul></li><li><a href="/blog/note/umd.html" class="sidebar-link">umd</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/umd.html#通用模块定义" class="sidebar-link">通用模块定义</a></li></ul></li><li><a href="/blog/note/watch.html" class="sidebar-link">watch</a></li><li><a href="/blog/note/snippets.html" class="sidebar-link">代码片段</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/snippets.html#数组操作" class="sidebar-link">数组操作</a></li></ul></li><li><a href="/blog/note/zepto-src.html" class="active sidebar-link">zepto 源码解读</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/note/zepto-src.html#源码注释" class="sidebar-link">源码注释</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="zepto-源码解读"><a href="#zepto-源码解读" aria-hidden="true" class="header-anchor">#</a> zepto 源码解读</h1> <div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>来源：（慕课网）<a href="https://www.imooc.com/learn/745" target="_blank" rel="noopener noreferrer">zepto源码分析课程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.kancloud.cn/wangfupeng/zepto-design-srouce/173692" target="_blank" rel="noopener noreferrer">原文档地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h2 id="源码注释"><a href="#源码注释" aria-hidden="true" class="header-anchor">#</a> 源码注释</h2> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">/* Zepto v1.1.6 - zepto event ajax form ie - zeptojs.com/license */</span>

<span class="token keyword">var</span> Zepto <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> $<span class="token punctuation">,</span> classList<span class="token punctuation">,</span> 

      <span class="token comment">// 获取数组的slice 和 filter（返回数组中的满足回调函数中指定的条件的元素）方法</span>
      emptyArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> slice <span class="token operator">=</span> emptyArray<span class="token punctuation">.</span>slice<span class="token punctuation">,</span> filter <span class="token operator">=</span> emptyArray<span class="token punctuation">.</span>filter<span class="token punctuation">,</span>

      document <span class="token operator">=</span> window<span class="token punctuation">.</span>document<span class="token punctuation">,</span>
      elementDisplay <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> classCache <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      cssNumber <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'column-count'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
        <span class="token string">'columns'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
        <span class="token string">'font-weight'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
        <span class="token string">'line-height'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">'opacity'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
        <span class="token string">'z-index'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> 
        <span class="token string">'zoom'</span><span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 取出html代码中第一个html标签（或注释），如取出 &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; 中的 &lt;p&gt;</span>
      fragmentRE <span class="token operator">=</span> <span class="token regex">/^\s*&lt;(\w+|!)[^&gt;]*&gt;/</span><span class="token punctuation">,</span>
      <span class="token comment">// 匹配 &lt;img /&gt; &lt;p&gt;&lt;/p&gt;  不匹配 &lt;img src=&quot;&quot;/&gt; &lt;p&gt;123&lt;/p&gt;</span>
      singleTagRE <span class="token operator">=</span> <span class="token regex">/^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/</span><span class="token punctuation">,</span>
      <span class="token comment">// 单标签</span>
      tagExpanderRE <span class="token operator">=</span> <span class="token regex">/&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/ig</span><span class="token punctuation">,</span>
      <span class="token comment">// body html</span>
      rootNodeRE <span class="token operator">=</span> <span class="token regex">/^(?:body|html)$/i</span><span class="token punctuation">,</span>
      <span class="token comment">// 大写字母</span>
      capitalRE <span class="token operator">=</span> <span class="token regex">/([A-Z])/g</span><span class="token punctuation">,</span>

      <span class="token comment">// special attributes that should be get/set via method calls</span>
      <span class="token comment">// 应该通过方法调用来设置/获取的特殊属性</span>
      methodAttributes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'val'</span><span class="token punctuation">,</span> <span class="token string">'css'</span><span class="token punctuation">,</span> <span class="token string">'html'</span><span class="token punctuation">,</span> <span class="token string">'text'</span><span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token string">'offset'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

      adjacencyOperators <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">'after'</span><span class="token punctuation">,</span> <span class="token string">'prepend'</span><span class="token punctuation">,</span> <span class="token string">'before'</span><span class="token punctuation">,</span> <span class="token string">'append'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>

      table <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'table'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      tableRow <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'tr'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// 指定特殊元素的 容器</span>
      containers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'tr'</span><span class="token punctuation">:</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'tbody'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'tbody'</span><span class="token punctuation">:</span> table<span class="token punctuation">,</span> 
        <span class="token string">'thead'</span><span class="token punctuation">:</span> table<span class="token punctuation">,</span> 
        <span class="token string">'tfoot'</span><span class="token punctuation">:</span> table<span class="token punctuation">,</span>
        <span class="token string">'td'</span><span class="token punctuation">:</span> tableRow<span class="token punctuation">,</span> 
        <span class="token string">'th'</span><span class="token punctuation">:</span> tableRow<span class="token punctuation">,</span>
        <span class="token comment">// 除了上面指定的，其他所有元素的容器都是 div</span>
        <span class="token string">'*'</span><span class="token punctuation">:</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// interactive ？？？</span>
      readyRE <span class="token operator">=</span> <span class="token regex">/complete|loaded|interactive/</span><span class="token punctuation">,</span>

      <span class="token comment">// 匹配一个包括（字母、数组、下划线、-）的字符串</span>
      simpleSelectorRE <span class="token operator">=</span> <span class="token regex">/^[\w-]*$/</span><span class="token punctuation">,</span>

      class2type <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      toString <span class="token operator">=</span> class2type<span class="token punctuation">.</span>toString<span class="token punctuation">,</span>

      zepto <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      camelize<span class="token punctuation">,</span> uniq<span class="token punctuation">,</span>

      tempParent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

      <span class="token comment">// 属性转换为 camalCase 格式。</span>
      <span class="token comment">// $.fn.prop 方法用到了</span>
      propMap <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'tabindex'</span><span class="token punctuation">:</span> <span class="token string">'tabIndex'</span><span class="token punctuation">,</span>
        <span class="token string">'readonly'</span><span class="token punctuation">:</span> <span class="token string">'readOnly'</span><span class="token punctuation">,</span>
        <span class="token string">'for'</span><span class="token punctuation">:</span> <span class="token string">'htmlFor'</span><span class="token punctuation">,</span>
        <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'className'</span><span class="token punctuation">,</span>
        <span class="token string">'maxlength'</span><span class="token punctuation">:</span> <span class="token string">'maxLength'</span><span class="token punctuation">,</span>
        <span class="token string">'cellspacing'</span><span class="token punctuation">:</span> <span class="token string">'cellSpacing'</span><span class="token punctuation">,</span>
        <span class="token string">'cellpadding'</span><span class="token punctuation">:</span> <span class="token string">'cellPadding'</span><span class="token punctuation">,</span>
        <span class="token string">'rowspan'</span><span class="token punctuation">:</span> <span class="token string">'rowSpan'</span><span class="token punctuation">,</span>
        <span class="token string">'colspan'</span><span class="token punctuation">:</span> <span class="token string">'colSpan'</span><span class="token punctuation">,</span>
        <span class="token string">'usemap'</span><span class="token punctuation">:</span> <span class="token string">'useMap'</span><span class="token punctuation">,</span>
        <span class="token string">'frameborder'</span><span class="token punctuation">:</span> <span class="token string">'frameBorder'</span><span class="token punctuation">,</span>
        <span class="token string">'contenteditable'</span><span class="token punctuation">:</span> <span class="token string">'contentEditable'</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 判断是否是arr的函数</span>
      isArray <span class="token operator">=</span> Array<span class="token punctuation">.</span>isArray <span class="token operator">||</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> object <span class="token keyword">instanceof</span> <span class="token class-name">Array</span> <span class="token punctuation">}</span>

  <span class="token comment">// 上文定义 zepto = {}</span>
  <span class="token comment">// 判断 element 是否符合 selector 的选择要求</span>
  zepto<span class="token punctuation">.</span><span class="token function-variable function">matches</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> selector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// selector有值，element有值，element是普通DOM节点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>selector <span class="token operator">||</span> <span class="token operator">!</span>element <span class="token operator">||</span> element<span class="token punctuation">.</span>nodeType <span class="token operator">!==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>

    <span class="token comment">// elem.matchesSelector('.item') </span>
    <span class="token comment">// 判断当前的 elem 是否符合传入的 selector 的要求 </span>
    <span class="token keyword">var</span> matchesSelector <span class="token operator">=</span> element<span class="token punctuation">.</span>webkitMatchesSelector <span class="token operator">||</span> 
                          element<span class="token punctuation">.</span>mozMatchesSelector <span class="token operator">||</span>
                          element<span class="token punctuation">.</span>oMatchesSelector <span class="token operator">||</span> 
                          element<span class="token punctuation">.</span>matchesSelector
    <span class="token keyword">if</span> <span class="token punctuation">(</span>matchesSelector<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">matchesSelector</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> selector<span class="token punctuation">)</span>

    <span class="token comment">// 浏览器不支持 matchesSelector</span>
    <span class="token comment">// fall back to performing a selector:</span>
    <span class="token keyword">var</span> match<span class="token punctuation">,</span> 
        parent <span class="token operator">=</span> element<span class="token punctuation">.</span>parentNode<span class="token punctuation">,</span> 
        temp <span class="token operator">=</span> <span class="token operator">!</span>parent

    <span class="token comment">// 上文定义 tempParent = document.createElement('div'),</span>
    <span class="token comment">// 如果没有parent，parent赋值为一个div，然后将当前元素加入到这个div中</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>temp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      parent <span class="token operator">=</span> tempParent<span class="token punctuation">;</span>
      tempParent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// (parent = tempParent).appendChild(element); 这种写法不易读</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 通过 qsa 获取匹配的元素，判断其中有没有 element</span>
    match <span class="token operator">=</span> <span class="token operator">~</span>zepto<span class="token punctuation">.</span><span class="token function">qsa</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> selector<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>temp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果没有parent时，之前执行过  tempParent.appendChild(element);</span>
      <span class="token comment">// 此时要移除子元素</span>
      tempParent<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// temp &amp;&amp; tempParent.removeChild(element)  // 这种写法不易读</span>

    <span class="token comment">// 返回最终的匹配结果，经过 qsa 判断的结果</span>
    <span class="token keyword">return</span> match
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> obj <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> 
           <span class="token function">String</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">:</span>  <span class="token comment">// null undefined</span>
           class2type<span class="token punctuation">[</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">&quot;object&quot;</span> 

    <span class="token comment">// 下文定义：</span>
    <span class="token comment">// // Populate the class2type map</span>
    <span class="token comment">// $.each(&quot;Boolean Number String Function Array Date RegExp Object Error&quot;.split(&quot; &quot;), function(i, name) {</span>
    <span class="token comment">//   class2type[ &quot;[object &quot; + name + &quot;]&quot; ] = name.toLowerCase()</span>
    <span class="token comment">// })</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">isFunction</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">type</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;function&quot;</span> <span class="token punctuation">}</span>
  <span class="token comment">// window的特点：window.window === window</span>
  <span class="token keyword">function</span> <span class="token function">isWindow</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span>     <span class="token punctuation">{</span> <span class="token keyword">return</span> obj <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> obj <span class="token operator">==</span> obj<span class="token punctuation">.</span>window <span class="token punctuation">}</span>
  <span class="token comment">// document.nodeType === 9</span>
  <span class="token comment">// elem.DOCUMENT_NODE 也等于 9 （这里直接判断是不是9也行？？？）</span>
  <span class="token keyword">function</span> <span class="token function">isDocument</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span>   <span class="token punctuation">{</span> <span class="token keyword">return</span> obj <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> obj<span class="token punctuation">.</span>nodeType <span class="token operator">==</span> obj<span class="token punctuation">.</span><span class="token constant">DOCUMENT_NODE</span> <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">isObject</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span>     <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">type</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;object&quot;</span> <span class="token punctuation">}</span>
  <span class="token comment">// 判断是否是最基本的object：Object.getPrototypeOf(obj) == Object.prototype</span>
  <span class="token keyword">function</span> <span class="token function">isPlainObject</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">isObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isWindow</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype
  <span class="token punctuation">}</span>
  <span class="token comment">// 数组或者对象数组</span>
  <span class="token keyword">function</span> <span class="token function">likeArray</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">typeof</span> obj<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token string">'number'</span> <span class="token punctuation">}</span>

  <span class="token comment">// 筛选数组，踢出 null undefined 元素</span>
  <span class="token keyword">function</span> <span class="token function">compact</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">filter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> item <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

  <span class="token comment">// 下文定义：</span>
  <span class="token comment">// $.fn = {</span>
  <span class="token comment">//    concat: emptyArray.concat,</span>
  <span class="token comment">// $.fn.concat.apply([], array) —— 无论 array 是不是数组，都将返回一个数组，</span>
  <span class="token comment">// 例如 $.fn.concat.call([], 'abc') 返回的是 ['abc']</span>
  <span class="token keyword">function</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> array<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> $<span class="token punctuation">.</span>fn<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> array<span class="token punctuation">)</span> <span class="token punctuation">:</span> array <span class="token punctuation">}</span>

  <span class="token comment">// camelize 已在上文定义</span>
  <span class="token comment">// 用于 css 的 camalCase 转换，例如 background-color 转换为 backgroundColor</span>
  <span class="token function-variable function">camelize</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/-+(.)?/g</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">match<span class="token punctuation">,</span> chr</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> chr <span class="token operator">?</span> chr<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

  <span class="token comment">// 将 lineHeight 转换为 line-height 格式</span>
  <span class="token keyword">function</span> <span class="token function">dasherize</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/::/g</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/([A-Z]+)([A-Z][a-z])/g</span><span class="token punctuation">,</span> <span class="token string">'$1_$2'</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/([a-z\d])([A-Z])/g</span><span class="token punctuation">,</span> <span class="token string">'$1_$2'</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/_/g</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// uniq变量已经在前面定义</span>
  <span class="token comment">// 用来将 [1,1,2,2,3,3] 替换为 [1,2,3]</span>
  <span class="token function-variable function">uniq</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">filter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token operator">==</span> idx <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

  <span class="token comment">// 上文定义 classCache = {}</span>
  <span class="token keyword">function</span> <span class="token function">classRE</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> name <span class="token keyword">in</span> classCache <span class="token operator">?</span>
           classCache<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token punctuation">:</span> 
           <span class="token punctuation">(</span>classCache<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'(^|\\s)'</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'(\\s|$)'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// classCache 存储的数据是这样的：</span>
    <span class="token comment">// {</span>
    <span class="token comment">//   abc: /(^|\s)abc(\s|$)/,  // 能匹配 'abc' 或 ' abc ' 或 ' abc' 或 'abc '</span>
    <span class="token comment">//   xyz: /(^|\s)abc(\s|$)/,</span>
    <span class="token comment">//   ...</span>
    <span class="token comment">// }</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 传入一个 css 的 name 和 value，判断这个 value 是否需要增加 'px'</span>
  <span class="token keyword">function</span> <span class="token function">maybeAddPx</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// dasherize(name) 将 lineHeight 转换为 line-height 格式</span>
    <span class="token comment">// !cssNumber[dasherize(name)] 判断转换出来的 css name 是否再这个数组之外</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">==</span> <span class="token string">&quot;number&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>cssNumber<span class="token punctuation">[</span><span class="token function">dasherize</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> 
           <span class="token comment">// 如果 value 是数字，并且 name 不在 cssNumber 数组之内，就需要加 'px'，否则不需要</span>
           <span class="token comment">// 例如 'width'、'font-size' 就需要加 'px'， 'font-weight' 就不需要加</span>
           value <span class="token operator">+</span> <span class="token string">&quot;px&quot;</span> <span class="token punctuation">:</span> 
           value

    <span class="token comment">// 前文定义----------------------</span>
    <span class="token comment">// cssNumber = {</span>
    <span class="token comment">//   'column-count': 1, </span>
    <span class="token comment">//   'columns': 1, </span>
    <span class="token comment">//   'font-weight': 1, </span>
    <span class="token comment">//   'line-height': 1,</span>
    <span class="token comment">//   'opacity': 1, </span>
    <span class="token comment">//   'z-index': 1, </span>
    <span class="token comment">//   'zoom': 1</span>
    <span class="token comment">// },</span>
    <span class="token comment">// function dasherize(str) {</span>
    <span class="token comment">//   return str.replace(/::/g, '/')</span>
    <span class="token comment">//             .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')</span>
    <span class="token comment">//             .replace(/([a-z\d])([A-Z])/g, '$1_$2')</span>
    <span class="token comment">//             .replace(/_/g, '-')</span>
    <span class="token comment">//             .toLowerCase()</span>
    <span class="token comment">// }</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 获取一个元素的默认 display 样式值，可能的结果是：inline block inline-block table .... （none 转换为 block）</span>
  <span class="token comment">// $.fn.show 方法中用到了</span>
  <span class="token keyword">function</span> <span class="token function">defaultDisplay</span><span class="token punctuation">(</span><span class="token parameter">nodeName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> element<span class="token punctuation">,</span> display

    <span class="token comment">// 前文定义 elementDisplay = {}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>elementDisplay<span class="token punctuation">[</span>nodeName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

      <span class="token comment">// 如果 elementDisplay 对象中，没有存储 nodeName 的信息</span>
      <span class="token comment">// 则新建一个 nodeName 元素，添加到 body 中</span>
      element <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>nodeName<span class="token punctuation">)</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
      <span class="token comment">// 获取它的默认的 display 样式信息。</span>
      display <span class="token operator">=</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;display&quot;</span><span class="token punctuation">)</span>
      <span class="token comment">// 接着马上移除元素！！！</span>
      element<span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
      <span class="token comment">// 'none' 换成 'block'，另外还可能是 'inline' 'inline-block' 'table' 等等...</span>
      display <span class="token operator">==</span> <span class="token string">&quot;none&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>display <span class="token operator">=</span> <span class="token string">&quot;block&quot;</span><span class="token punctuation">)</span>
      <span class="token comment">// 存储下来</span>
      elementDisplay<span class="token punctuation">[</span>nodeName<span class="token punctuation">]</span> <span class="token operator">=</span> display

      <span class="token comment">// 下文定义 </span>
      <span class="token comment">// var nativeGetComputedStyle = getComputedStyle;</span>
      <span class="token comment">// window.getComputedStyle = function(element){</span>
      <span class="token comment">//   try {</span>
      <span class="token comment">//     return nativeGetComputedStyle(element)</span>
      <span class="token comment">//   } catch(e) {</span>
      <span class="token comment">//     return null</span>
      <span class="token comment">//   }</span>
      <span class="token comment">// }</span>
      <span class="token comment">// 解释：</span>
      <span class="token comment">// 如果浏览器支持 getComputedStyle 则使用，如果不支持，就返回 null</span>
      <span class="token comment">// getComputedStyle(elem, '伪类，如 :link') 返回一个 CSSStyleDeclaration 对象，里面存储了元素的样式信息，可以通过 getPropertyValue('name') 方法获取</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 最终返回 display 结果</span>
    <span class="token keyword">return</span> elementDisplay<span class="token punctuation">[</span>nodeName<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 返回一个元素的子元素，数组形式</span>
  <span class="token keyword">function</span> <span class="token function">children</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// 有些浏览器支持 elem.children 获取子元素，有些不支持</span>
    <span class="token keyword">return</span> <span class="token string">'children'</span> <span class="token keyword">in</span> element <span class="token operator">?</span>

           <span class="token comment">// 上文定义 slice = [].slice</span>
           <span class="token comment">// slice.call(likeArr) 可以将对象数组转换为真正的数组</span>
           <span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>children<span class="token punctuation">)</span> <span class="token punctuation">:</span>

           <span class="token comment">// 浏览器不支持 elem.children 只能通过 elem.childNodes 获取子元素</span>
           <span class="token comment">// 只去 node.nodeType == 1 的子元素，通过 $.map 拼接成数组</span>
           <span class="token comment">// $.map 下文定义的， $.map = function (elements, callback) {....}</span>
           <span class="token comment">// $.map 作用：针对 elements（对象数组或数组），对每个元素都经过 callback 函数的过滤，并将过滤通过的元素，push到一个新数组中，返回新数组</span>
           $<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span>childNodes<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeType <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> node <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>


  <span class="token comment">// 上文定义 zepto = {}</span>
  <span class="token comment">// 上文定义 zepto.matches = function(element, selector) { /* 判断elem是否符合selector的要求 */ }</span>

  <span class="token comment">// `$.zepto.fragment` takes a html string and an optional tag name</span>
  <span class="token comment">// to generate DOM nodes nodes from the given html string.</span>
  <span class="token comment">// The generated DOM nodes are returned as an array.</span>
  <span class="token comment">// This function can be overriden in plugins for example to make</span>
  <span class="token comment">// it compatible with browsers that don't support the DOM fully.</span>
  zepto<span class="token punctuation">.</span><span class="token function-variable function">fragment</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">html<span class="token punctuation">,</span> name<span class="token punctuation">,</span> properties</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*
      参数：
      @html: 待处理的html字符串
      @name: 通过 name 可在 containers 中查找容器节点，如果不传入，取得的容器默认为 div
      @properties: 节点属性对象
    */</span>

    <span class="token keyword">var</span> dom<span class="token punctuation">,</span> nodes<span class="token punctuation">,</span> container

    <span class="token comment">// 上文定义：singleTagRE = /^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/,   // 匹配 &lt;img /&gt; &lt;p&gt;&lt;/p&gt;  不匹配 &lt;img src=&quot;&quot;/&gt; &lt;p&gt;123&lt;/p&gt;</span>
    <span class="token comment">// 如果 html 是单标签，则直接用该标签创建元素</span>
    <span class="token comment">// RegExp.$1 表示正则中的第一个括号匹配的内容，在此即 (\w+) 匹配的内容，</span>
    <span class="token comment">// A special case optimization for a single tag</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>singleTagRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">)</span> dom <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">.</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 说明 html 不是单标签，dom未被赋值</span>

      <span class="token comment">// 上文定义 tagExpanderRE = /&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/ig,   // 单标签</span>
      <span class="token comment">// 将 &lt;p/&gt;或&lt;p /&gt;，替换为 &lt;p&gt;&lt;/p&gt;，将&lt;p abc/&gt;替换为&lt;p&gt;abc&lt;/p&gt;</span>
      <span class="token comment">// &lt;input/&gt; （在 tagExpanderRE 中定义）的不替换</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>html<span class="token punctuation">.</span>replace<span class="token punctuation">)</span> html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>tagExpanderRE<span class="token punctuation">,</span> <span class="token string">&quot;&lt;$1&gt;&lt;/$2&gt;&quot;</span><span class="token punctuation">)</span>

      <span class="token comment">// fragmentRE = /^\s*&lt;(\w+|!)[^&gt;]*&gt;/,   // 取出html代码中第一个html标签（或注释），如取出 &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; 中的 &lt;p&gt;</span>
      <span class="token comment">// 如果 name 未传入，则赋值为 html 的第一个标签</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> name <span class="token operator">=</span> fragmentRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> RegExp<span class="token punctuation">.</span>$<span class="token number">1</span>

      <span class="token comment">// 上文定义</span>
      <span class="token comment">// // 指定特殊元素的 容器</span>
      <span class="token comment">// containers = {</span>
      <span class="token comment">//   'tr': document.createElement('tbody'),</span>
      <span class="token comment">//   'tbody': table, </span>
      <span class="token comment">//   'thead': table, </span>
      <span class="token comment">//   'tfoot': table,</span>
      <span class="token comment">//   'td': tableRow, </span>
      <span class="token comment">//   'th': tableRow,</span>
      <span class="token comment">//   // 除了上面指定的，其他所有元素的容器都是 div</span>
      <span class="token comment">//   '*': document.createElement('div')</span>
      <span class="token comment">// },</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>name <span class="token keyword">in</span> containers<span class="token punctuation">)</span><span class="token punctuation">)</span> name <span class="token operator">=</span> <span class="token string">'*'</span>

      container <span class="token operator">=</span> containers<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
      container<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span> <span class="token operator">+</span> html  <span class="token comment">// 转变为字符串的快捷方式</span>

      <span class="token comment">// 遍历 container 的子元素（先转换为数组形式）</span>
      <span class="token comment">// 返回的同时，将每个子元素移除。</span>
      <span class="token comment">// $.each 返回的是一个数组，因为第一个参数就是数组 slice.call(container.childNodes)</span>
      dom <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>container<span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        container<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 赋值属性</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 先将dom转换为 zepto 对象</span>
      nodes <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span>

      $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>properties<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 上文定义：</span>
        <span class="token comment">// // 应该通过方法调用来设置/获取的特殊属性</span>
        <span class="token comment">// methodAttributes = ['val', 'css', 'html', 'text', 'data', 'width', 'height', 'offset'],</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>methodAttributes<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> nodes<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>  <span class="token comment">// 满足 methodAttributes 的，通过方法赋值</span>
        <span class="token keyword">else</span> nodes<span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token comment">// 否则，通过属性复制</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 最终返回的dom可能有两种形式</span>
    <span class="token comment">// 第一，如果 html 是单标签，则dom被复制为一个zepto对象 dom = $(document.createElement(RegExp.$1))</span>
    <span class="token comment">// 第二，如果 html 不是单标签，则dom被复制为一个DOM节点的数组</span>
    <span class="token keyword">return</span> dom
  <span class="token punctuation">}</span>


  <span class="token comment">// 上文定义 zepto = {}</span>
  <span class="token comment">// 上文定义 zepto.matches = function(element, selector) { /* 判断elem是否符合selector的要求 */ }</span>
  <span class="token comment">// 上文定义 zepto.fragment = function(html, name, properties) { /* 通过html字符串获取文档碎片 */ }</span>

  <span class="token comment">// `$.zepto.Z` swaps out the prototype of the given `dom` array</span>
  <span class="token comment">// of nodes with `$.fn` and thus supplying all the Zepto functions</span>
  <span class="token comment">// to the array. Note that `__proto__` is not supported on Internet</span>
  <span class="token comment">// Explorer. This method can be overriden in plugins.</span>
  zepto<span class="token punctuation">.</span><span class="token function-variable function">Z</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dom<span class="token punctuation">,</span> selector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    dom <span class="token operator">=</span> dom <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment">// 将 dom 隐式原型强制改为 $.fn</span>
    <span class="token comment">// 下文 zepto.Z.prototype = $.fn   因此，dom.__proto__ = $.fn 即 dom.__proto__ = zepto.Z.prototype  可以不较真的认为 zepto.Z 就是一个构造函数（但感觉这么设计，有些蹩脚）</span>
    dom<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> $<span class="token punctuation">.</span>fn
    dom<span class="token punctuation">.</span>selector <span class="token operator">=</span> selector <span class="token operator">||</span> <span class="token string">''</span>
    <span class="token keyword">return</span> dom
  <span class="token punctuation">}</span>

  <span class="token comment">// `$.zepto.isZ` should return `true` if the given object is a Zepto</span>
  <span class="token comment">// collection. This method can be overriden in plugins.</span>
  zepto<span class="token punctuation">.</span><span class="token function-variable function">isZ</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 上文 dom.__proto__ = $.fn</span>
    <span class="token comment">// 下文 zepto.Z.prototype = $.fn</span>
    <span class="token comment">// 可知：dom.__proto__ === $.fn === zepto.Z.prototype</span>

    <span class="token comment">// 因此，zepto对象都符合 object instanceof zepto.Z</span>
    <span class="token keyword">return</span> object <span class="token keyword">instanceof</span> <span class="token class-name">zepto<span class="token punctuation">.</span>Z</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// `$.zepto.init` is Zepto's counterpart to jQuery's `$.fn.init` and</span>
  <span class="token comment">// takes a CSS selector and an optional context (and handles various</span>
  <span class="token comment">// special cases).</span>
  <span class="token comment">// This method can be overriden in plugins.</span>
  zepto<span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> dom
    <span class="token comment">// If nothing given, return an empty Zepto collection</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>selector<span class="token punctuation">)</span> <span class="token keyword">return</span> zepto<span class="token punctuation">.</span><span class="token constant">Z</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Optimize for string selectors</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> selector <span class="token operator">==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 字符串的情况，一般有两种：</span>
      <span class="token comment">// 第一，一段 html 代码，旨在通过zepto生成dom对象</span>
      <span class="token comment">// 第二，一段查询字符串，旨在通过zepto查找dom对象</span>
      <span class="token comment">// 将查询结果存储到 dom 变量中</span>

      selector <span class="token operator">=</span> selector<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// If it's a html fragment, create nodes from it</span>
      <span class="token comment">// Note: In both Chrome 21 and Firefox 15, DOM error 12</span>
      <span class="token comment">// is thrown if the fragment doesn't begin with &lt;</span>

      <span class="token comment">// 上文定义：</span>
      <span class="token comment">// // 取出html代码中第一个html标签（或注释），如取出 &lt;p&gt;123&lt;/p&gt;&lt;h1&gt;345&lt;/h1&gt; 中的 &lt;p&gt;</span>
      <span class="token comment">// fragmentRE = /^\s*&lt;(\w+|!)[^&gt;]*&gt;/,</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>selector<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'&lt;'</span> <span class="token operator">&amp;&amp;</span> fragmentRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment">// 第一，RegExp.$1取出来的就是第一个标签名称，即正则中 (\w+|!) 对应的内容</span>
        <span class="token comment">// 第二，此时的 context 应该传入的是css属性对象（这里会产生歧义，老版的不会传入 context）</span>
        dom <span class="token operator">=</span> zepto<span class="token punctuation">.</span><span class="token function">fragment</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> RegExp<span class="token punctuation">.</span>$<span class="token number">1</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">,</span> selector <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token comment">// If there's a context, create a collection on that context first, and select</span>
      <span class="token comment">// nodes from there</span>

      <span class="token comment">// 如果 selector 不是html字符串标签，并且 context 有值，则从context中查找</span>
      <span class="token comment">// find 应该是在 $.fn 中定义的，有待解读？？？</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
      <span class="token comment">// If it's a CSS selector, use it to select nodes.</span>

      <span class="token comment">// 除了以上情况，就从整个 document 执行 qsa 的查找</span>
      <span class="token keyword">else</span> dom <span class="token operator">=</span> zepto<span class="token punctuation">.</span><span class="token function">qsa</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> selector<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// If a function is given, call it when the DOM is ready</span>
    <span class="token comment">// 如果是函数，则dom ready时执行，</span>
    <span class="token comment">// ready方法应该在 $.fn 中定义，有待解毒</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>

    <span class="token comment">// If a Zepto collection is given, just return it</span>
    <span class="token comment">// 传入的参数本身就已经是 zepto 对象，则直接返回</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>zepto<span class="token punctuation">.</span><span class="token function">isZ</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> selector
    <span class="token keyword">else</span> <span class="token punctuation">{</span>

      <span class="token comment">// compact函数：踢出数组中 == null 的元素</span>
      <span class="token comment">// normalize array if an array of nodes is given</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span> dom <span class="token operator">=</span> <span class="token function">compact</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>

      <span class="token comment">// 如果传入的是object，直接强制塞进一个数组</span>
      <span class="token comment">// Wrap DOM nodes.</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span> dom <span class="token operator">=</span> <span class="token punctuation">[</span>selector<span class="token punctuation">]</span><span class="token punctuation">,</span> selector <span class="token operator">=</span> <span class="token keyword">null</span>  <span class="token comment">// 及时清空 selector 不妨碍下面的判断</span>


      <span class="token comment">// 从此往下，感觉和上文 selector 是字符串的情况下，重复了</span>
      <span class="token comment">// ？？？？？？？？</span>


      <span class="token comment">// fragmentRE.test 即判断字符串是否是 html 标签开头（即是否是html fragement）</span>
      <span class="token comment">// If it's a html fragment, create nodes from it</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>fragmentRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">//此时，context 也是属性集合，不是容器！！！</span>
        <span class="token comment">//（这里会产生歧义，老版的不会传入 context）</span>
        dom <span class="token operator">=</span> zepto<span class="token punctuation">.</span><span class="token function">fragment</span><span class="token punctuation">(</span>selector<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> RegExp<span class="token punctuation">.</span>$<span class="token number">1</span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">,</span> selector <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// 及时清空 selector 不妨碍下面的判断</span>
      <span class="token comment">// If there's a context, create a collection on that context first, and select</span>
      <span class="token comment">// nodes from there</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
      <span class="token comment">// And last but no least, if it's a CSS selector, use it to select nodes.</span>
      <span class="token keyword">else</span> dom <span class="token operator">=</span> zepto<span class="token punctuation">.</span><span class="token function">qsa</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> selector<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 最终，还是通过 zepto.Z 创建了对象</span>
    <span class="token comment">// 这里的 dom，其实就是一个数组</span>
    <span class="token comment">// create a new Zepto collection from the nodes found</span>
    <span class="token keyword">return</span> zepto<span class="token punctuation">.</span><span class="token constant">Z</span><span class="token punctuation">(</span>dom<span class="token punctuation">,</span> selector<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// `$` will be the base `Zepto` object. When calling this</span>
  <span class="token comment">// function just call `$.zepto.init, which makes the implementation</span>
  <span class="token comment">// details of selecting nodes and creating Zepto collections</span>
  <span class="token comment">// patchable in plugins.</span>
  <span class="token function-variable function">$</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> zepto<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> context<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// $ 最终被这个匿名函数所返回，并复制给了全局的 Zepto 变量</span>
  <span class="token comment">// 全局的 zepto 变量暴露给了 window，并且可能有一个别名—— $</span>
  <span class="token comment">// 此 $ 非彼 $ </span>
  <span class="token comment">// 对于初学者来说，这里肯定非常绕（还不如把这里的 $ 改改名字）</span>


  <span class="token keyword">function</span> <span class="token function">extend</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> source<span class="token punctuation">,</span> deep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// key 在上文已经定义，否则就污染全局变量了</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> source<span class="token punctuation">)</span>

      <span class="token comment">// 深度递归，首先必须 deep 参数为 true</span>
      <span class="token comment">// 其次，source[key] 必须是数组或者对象，才有必要深度递归（否则没必要）</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>deep <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isArray</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token comment">// source[key] 是对象，而 target[key] 不是对象</span>
        <span class="token comment">// 则 target[key] = {} 初始化一下，否则递归会出错的</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isPlainObject</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

        <span class="token comment">// source[key] 是数组，而 target[key] 不是数组</span>
        <span class="token comment">// 则 target[key] = [] 初始化一下，否则递归会出错的</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isArray</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token comment">// 执行递归</span>
        <span class="token function">extend</span><span class="token punctuation">(</span>target<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> deep<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 不满足以上条件，说明 source[key] 是一般的值类型，直接赋值给 target 就是了</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>source<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> target<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Copy all but undefined properties from one or more</span>
  <span class="token comment">// objects to the `target` object.</span>
  $<span class="token punctuation">.</span><span class="token function-variable function">extend</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 一般传入的参数会是：</span>
    <span class="token comment">// (targetObj, srcObj1, srcObj2, srcObj1...)</span>
    <span class="token comment">// (true, targetObj, srcObj1, srcObj2, srcObj1...)</span>

    <span class="token comment">// arguments 是对象数组，slice.call 会返回真正的数组（此处返回从第二项开始）</span>
    <span class="token keyword">var</span> deep<span class="token punctuation">,</span> args <span class="token operator">=</span> <span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token comment">// 第一个参数是boolean，这里会把第二个参数当做 target，其他的作为 source</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> target <span class="token operator">==</span> <span class="token string">'boolean'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      deep <span class="token operator">=</span> target
      target <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 将所有的 source 添加到 target 中</span>
    args<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">extend</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> arg<span class="token punctuation">,</span> deep<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> target

    <span class="token comment">// 感觉这样设计是比较好，很好的将业务和底层进行了分离（虽然比较简单）：</span>
    <span class="token comment">// 核心方法再 function extend(...){...} 中定义，</span>
    <span class="token comment">// 而 $.extend 方法中做一些外围的判断和处理，最终调用 extend 函数去执行</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// `$.zepto.qsa` is Zepto's CSS selector implementation which</span>
  <span class="token comment">// uses `document.querySelectorAll` and optimizes for some special cases, like `#id`.</span>
  <span class="token comment">// This method can be overriden in plugins.</span>
  zepto<span class="token punctuation">.</span><span class="token function-variable function">qsa</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> selector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">/*
      @element: 容器
      @selector: 选择器
    */</span>

    <span class="token keyword">var</span> found<span class="token punctuation">,</span>
        maybeID <span class="token operator">=</span> selector<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'#'</span><span class="token punctuation">,</span>
        maybeClass <span class="token operator">=</span> <span class="token operator">!</span>maybeID <span class="token operator">&amp;&amp;</span> selector<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'.'</span><span class="token punctuation">,</span>

        <span class="token comment">// ID或class形式：返回 selector.slice(1) 即ID或者class的值</span>
        <span class="token comment">// 否则：返回 selector，如通过 tagName 查询</span>
        nameOnly <span class="token operator">=</span> maybeID <span class="token operator">||</span> maybeClass <span class="token operator">?</span> selector<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> selector<span class="token punctuation">,</span> <span class="token comment">// Ensure that a 1 char tag name still gets checked</span>
        
        <span class="token comment">// 是否是一个简单的字符串（可能是一个复杂的选择器，如 'div#div1 .item[link] .red'）</span>
        isSimple <span class="token operator">=</span> simpleSelectorRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>nameOnly<span class="token punctuation">)</span>

    <span class="token comment">// 上文定义：</span>
    <span class="token comment">// // 匹配一个包括（字母、数组、下划线、-）的字符串</span>
    <span class="token comment">// simpleSelectorRE = /^[\w-]*$/,</span>



    <span class="token comment">// 以下代码的基本思路是：</span>
    <span class="token comment">// 1. 优先通过 ID 获取元素；</span>
    <span class="token comment">// 2. 然后试图通过 className 和 tagName 获取元素</span>
    <span class="token comment">// 3. 最后通过 querySelectorAll 来获取</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">isDocument</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> isSimple <span class="token operator">&amp;&amp;</span> maybeID<span class="token punctuation">)</span> <span class="token operator">?</span>
           <span class="token comment">// 这是最简单的形式：容器是document、选择器是一个id</span>
           <span class="token comment">// 因为 getElementById 只能在 document 上用，所以这里单独拿出来</span>
           <span class="token punctuation">(</span> <span class="token punctuation">(</span>found <span class="token operator">=</span> element<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>nameOnly<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> 
              <span class="token punctuation">[</span>found<span class="token punctuation">]</span> <span class="token punctuation">:</span> 
              <span class="token punctuation">[</span><span class="token punctuation">]</span> 
           <span class="token punctuation">)</span> <span class="token punctuation">:</span>

           <span class="token punctuation">(</span>element<span class="token punctuation">.</span>nodeType <span class="token operator">!==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> element<span class="token punctuation">.</span>nodeType <span class="token operator">!==</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token operator">?</span> 
              <span class="token comment">// 容器不是一般元素，也不是document，直接返回 []</span>
              <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">:</span>

              <span class="token comment">// 将获取的所有元素集合，都转换为数组</span>
              <span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
                isSimple <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>maybeID 

                <span class="token comment">// isSimple情况下，nameOnly 只可能是 className 或者 tagName</span>
                <span class="token comment">// getElementsByClassName 和 getElementsByTagName 可以在 elem 上用，而且比 querySelectorAll 速度快</span>
                <span class="token comment">// 所以，只要elem容器有值，尽量单独拿出来处理</span>
                <span class="token operator">?</span> 
                  maybeClass <span class="token operator">?</span> 
                  element<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span>nameOnly<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token comment">// If it's simple, it could be a class</span>
                  element<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>  <span class="token comment">// Or a tag</span>

                <span class="token comment">// 最后其他情况，只能通过 querySelectorAll 来处理</span>
                <span class="token punctuation">:</span> 
                element<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token comment">// Or it's not simple, and we need to query all</span>
              <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 根据 selector 筛选 nodes </span>
  <span class="token comment">// 并将 nodes 封装为 zepto 对象</span>
  <span class="token comment">// $.fn.filter 下文定义</span>
  <span class="token keyword">function</span> <span class="token function">filtered</span><span class="token punctuation">(</span><span class="token parameter">nodes<span class="token punctuation">,</span> selector</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> selector <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token function">$</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 判断 parent 是否包含 node</span>
  $<span class="token punctuation">.</span>contains <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>contains <span class="token operator">?</span>
    <span class="token comment">// 浏览器支持 contains 方法</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> parent <span class="token operator">!==</span> node <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token punctuation">:</span>
    <span class="token comment">// 不支持 contains 方法</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">parent<span class="token punctuation">,</span> node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>node <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>node <span class="token operator">=</span> node<span class="token punctuation">.</span>parentNode<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">===</span> parent<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span>

  <span class="token comment">// 如果 arg 是函数，则改变函数的执行环境和参数</span>
  <span class="token comment">// 如果不是，直接返回 arg</span>
  <span class="token comment">// $.fn.html 方法就用到了</span>
  <span class="token keyword">function</span> <span class="token function">funcArg</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> arg<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> payload</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">arg</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> payload<span class="token punctuation">)</span> <span class="token punctuation">:</span> arg
  <span class="token punctuation">}</span>

  <span class="token comment">// 设置属性</span>
  <span class="token keyword">function</span> <span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> node<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">:</span> node<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 设置或获取 node 的 className</span>
  <span class="token comment">// 考虑 svg ？？？？</span>
  <span class="token comment">// access className property while respecting SVGAnimatedString</span>
  <span class="token keyword">function</span> <span class="token function">className</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> klass <span class="token operator">=</span> node<span class="token punctuation">.</span>className <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
        svg   <span class="token operator">=</span> klass <span class="token operator">&amp;&amp;</span> klass<span class="token punctuation">.</span>baseVal <span class="token operator">!==</span> <span class="token keyword">undefined</span>

    <span class="token comment">// 获取</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> svg <span class="token operator">?</span> klass<span class="token punctuation">.</span>baseVal <span class="token punctuation">:</span> klass
    <span class="token comment">// 设置</span>
    svg <span class="token operator">?</span> <span class="token punctuation">(</span>klass<span class="token punctuation">.</span>baseVal <span class="token operator">=</span> value<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>className <span class="token operator">=</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 将字符串变成响应的对象或者值，例如源代码的注释：</span>
  <span class="token comment">// &quot;true&quot;  =&gt; true</span>
  <span class="token comment">// &quot;false&quot; =&gt; false</span>
  <span class="token comment">// &quot;null&quot;  =&gt; null</span>
  <span class="token comment">// &quot;42&quot;    =&gt; 42</span>
  <span class="token comment">// &quot;42.5&quot;  =&gt; 42.5</span>
  <span class="token comment">// &quot;08&quot;    =&gt; &quot;08&quot;</span>
  <span class="token comment">// JSON    =&gt; parse if valid</span>
  <span class="token comment">// String  =&gt; self</span>
  <span class="token keyword">function</span> <span class="token function">deserializeValue</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> value <span class="token operator">?</span>

        <span class="token comment">// value『有值』的情况：</span>
        value <span class="token operator">==</span> <span class="token string">&quot;true&quot;</span> <span class="token operator">||</span>  <span class="token comment">// 如果 value == 'true'，那么这个表达式本身就返回 true ，导致整个函数返回true</span>

          <span class="token comment">// value !== 'true' 的情况：</span>
          <span class="token punctuation">(</span> 
            value <span class="token operator">==</span> <span class="token string">&quot;false&quot;</span> <span class="token operator">?</span> <span class="token boolean">false</span> <span class="token punctuation">:</span> <span class="token comment">// &quot;null&quot;  =&gt; null</span>
            value <span class="token operator">==</span> <span class="token string">&quot;null&quot;</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token punctuation">:</span> <span class="token comment">// &quot;null&quot;  =&gt; null</span>
            <span class="token operator">+</span>value <span class="token operator">+</span> <span class="token string">&quot;&quot;</span> <span class="token operator">==</span> value <span class="token operator">?</span> <span class="token operator">+</span>value <span class="token punctuation">:</span>  <span class="token comment">// 数字：&quot;42&quot; =&gt; 42  &quot;42.5&quot; =&gt; 42.5  （ 但是 '08' 却不符合这个条件 ）</span>
            <span class="token operator">/</span><span class="token operator">^</span><span class="token punctuation">[</span>\<span class="token punctuation">[</span>\<span class="token punctuation">{</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> $<span class="token punctuation">.</span><span class="token function">parseJSON</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token comment">// '[...]' 或者 '{...}'</span>
            value <span class="token comment">// 其他</span>
          <span class="token punctuation">)</span>

        <span class="token comment">// value『无值』的情况： undefined / '' / flase / 0 / null</span>
        <span class="token punctuation">:</span> value 
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 将上文定义的函数，暴露给 $ 对象（其实 $ 是一个 function）</span>
  $<span class="token punctuation">.</span>type <span class="token operator">=</span> type
  $<span class="token punctuation">.</span>isFunction <span class="token operator">=</span> isFunction
  $<span class="token punctuation">.</span>isWindow <span class="token operator">=</span> isWindow
  $<span class="token punctuation">.</span>isArray <span class="token operator">=</span> isArray
  $<span class="token punctuation">.</span>isPlainObject <span class="token operator">=</span> isPlainObject

  $<span class="token punctuation">.</span><span class="token function-variable function">isEmptyObject</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> name
    <span class="token keyword">for</span> <span class="token punctuation">(</span>name <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>

  $<span class="token punctuation">.</span><span class="token function-variable function">inArray</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">elem<span class="token punctuation">,</span> array<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> emptyArray<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> elem<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  $<span class="token punctuation">.</span>camelCase <span class="token operator">=</span> camelize
  $<span class="token punctuation">.</span><span class="token function-variable function">trim</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> str <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// plugin compatibility</span>
  $<span class="token punctuation">.</span>uuid <span class="token operator">=</span> <span class="token number">0</span>
  $<span class="token punctuation">.</span>support <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
  $<span class="token punctuation">.</span>expr <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

  <span class="token comment">// 重新组织 elements 对象（数组、对象或者对象数组），针对每一个元素，都用 callback 进行检验</span>
  <span class="token comment">// 检验通过后，将元素push进一个新数组，并返回</span>
  $<span class="token punctuation">.</span><span class="token function-variable function">map</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">elements<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> value<span class="token punctuation">,</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> key

    <span class="token comment">// 数组，或者对象数组</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">likeArray</span><span class="token punctuation">(</span>elements<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 遍历，经过 callback 验证，push到结果中</span>
        value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span>elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

    <span class="token comment">// 对象</span>
    <span class="token keyword">else</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> elements<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 遍历，经过 callback 验证，push到结果中</span>
        value <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span>elements<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

    <span class="token comment">// 返回数组</span>
    <span class="token comment">// flatten 函数上文定义的，作用：无论 values 是否是数组，都将返回一个正确的数组。例如，传入 'abc' ，返回 ['abc']</span>
    <span class="token keyword">return</span> <span class="token function">flatten</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 遍历 elements 所有元素（数组、对象数组、对象），执行 callback 方法，最终还是返回 elements</span>
  <span class="token comment">// 注意1：callback.call(elements[i], i, elements[i]) 函数执行的环境和参数</span>
  <span class="token comment">// 注意2：=== false) return elements 一旦有函数返回 false，即跳出循环，类似 break</span>
  <span class="token comment">// 注意3：无论哪种情况，最终返回的还是 elements</span>
  $<span class="token punctuation">.</span><span class="token function-variable function">each</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">elements<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> i<span class="token punctuation">,</span> key
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">likeArray</span><span class="token punctuation">(</span>elements<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> elements<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> elements<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">return</span> elements
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> elements<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>elements<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> elements<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token keyword">return</span> elements
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> elements
  <span class="token punctuation">}</span>

  <span class="token comment">// 上文定义：filter = emptyArray.filter</span>
  <span class="token comment">// 筛选数组</span>
  $<span class="token punctuation">.</span><span class="token function-variable function">grep</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">elements<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">filter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>elements<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span><span class="token constant">JSON</span><span class="token punctuation">)</span> $<span class="token punctuation">.</span>parseJSON <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span>parse

  <span class="token comment">// Populate the class2type map</span>
  $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token string">&quot;Boolean Number String Function Array Date RegExp Object Error&quot;</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    class2type<span class="token punctuation">[</span> <span class="token string">&quot;[object &quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span> <span class="token punctuation">]</span> <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">/*
      上文将 class2type 赋值为 {}
      最终将 class2type 赋值为：
      {
        '[object boolean]': 'boolean',
        '[object number]': 'number',
        '[object string]': 'string',
        ...
      }

      存储这个数据是为了方便的获取一些对象的类型，
      例如 Object.prototype.toString.call([]) 返回的是 '[Object Array]'
      那么即可根据这个获取 [] 的类型是 'array'
    */</span>
    
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// Define methods that will be available on all</span>
  <span class="token comment">// Zepto collections</span>
  $<span class="token punctuation">.</span>fn <span class="token operator">=</span> <span class="token punctuation">{</span>

    <span class="token comment">// 为何要这么多数组的方法？</span>
    <span class="token comment">// 因为一个 zepto 对象，本身就是一个数组</span>

    <span class="token comment">// Because a collection acts like an array</span>
    <span class="token comment">// copy over these useful array functions.</span>
    forEach<span class="token punctuation">:</span> emptyArray<span class="token punctuation">.</span>forEach<span class="token punctuation">,</span>
    reduce<span class="token punctuation">:</span> emptyArray<span class="token punctuation">.</span>reduce<span class="token punctuation">,</span>  <span class="token comment">// 方法何用？？？？</span>
    push<span class="token punctuation">:</span> emptyArray<span class="token punctuation">.</span>push<span class="token punctuation">,</span>
    sort<span class="token punctuation">:</span> emptyArray<span class="token punctuation">.</span>sort<span class="token punctuation">,</span>
    indexOf<span class="token punctuation">:</span> emptyArray<span class="token punctuation">.</span>indexOf<span class="token punctuation">,</span>
    concat<span class="token punctuation">:</span> emptyArray<span class="token punctuation">.</span>concat<span class="token punctuation">,</span>

    <span class="token comment">// `map` and `slice` in the jQuery API work differently</span>
    <span class="token comment">// from their array counterparts</span>
    <span class="token function-variable function">map</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// $.map 上文定义的， $.map = function (elements, callback) {....}</span>
      <span class="token comment">// $.map 作用：针对 elements（对象、对象数组或数组），对每个元素都经过 callback 函数的过滤，并将过滤通过的元素，push到一个新数组中，返回新数组</span>

      <span class="token comment">// 最后，用 $ 封装返回</span>
      <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span>
        <span class="token comment">// $.map 返回的是一个数组</span>
        $<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> 
          <span class="token comment">// 针对每一个元素，都执行传入的函数，如果函数返回的 !=null 就将插入到新返回的数组</span>
          <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> i</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> i<span class="token punctuation">,</span> el<span class="token punctuation">)</span> <span class="token punctuation">}</span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>

      <span class="token comment">/*
        $('div').map(function(key, value){
          return value.id;
          // 或者 return this.id;
        })
        这个结果就是 $(['div1', 'div2' ...])
      */</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">slice</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 直接数组的slice方法，并将结果用 $ 封装返回</span>
      <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 在 zepto.init 函数中，当传入的函数是函数时，就用到了 ready </span>
    <span class="token comment">// else if (isFunction(selector)) return $(document).ready(selector)</span>
    <span class="token function-variable function">ready</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// need to check if document.body exists for IE as that browser reports</span>
      <span class="token comment">// document ready when it hasn't yet created the body element</span>

      <span class="token comment">// 下文定义：readyRE = /complete|loaded|interactive/,</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>readyRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> document<span class="token punctuation">.</span>body<span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span>
      <span class="token keyword">else</span> document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">callback</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>

      <span class="token comment">// 返回当前对象</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> idx <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> 
             <span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token comment">// 未传参数，直接返回一整个数组</span>
             <span class="token comment">// 有参数，则试图返回单个元素（大于0，小于0 两种情况）</span>
             <span class="token keyword">this</span><span class="token punctuation">[</span>
                idx <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">?</span> 
                idx <span class="token punctuation">:</span> 
                idx <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length
            <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 将zepto集合变为纯数组</span>
    <span class="token function-variable function">toArray</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function-variable function">size</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 将元素从这个DOM树中移除</span>
    <span class="token function-variable function">remove</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>parentNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function-variable function">each</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// [].every ES5中Array的新特性。循环数组每个元素，返回是否符合callback函数的要求</span>

      <span class="token comment">// every 函数返回的是 false 或者 true（不过这里返回什么无所谓，执行就可以了）</span>
      emptyArray<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> el<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// 最后返回本身对象</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">filter</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// not函数下文定义</span>
      <span class="token comment">// 如果给not传入的参数是函数，则返回不符合这个函数规则的元素的数组（用 $ 封装）</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">not</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">)</span>

      <span class="token comment">// 上文定义：zepto.matches 判断elements是否符合 selector 的要求</span>
      <span class="token comment">// zepto.matches = function(element, selector) {...}</span>
      <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 利用 [].filter 方法做筛选，利用 zepto.matches 做判断</span>
        <span class="token keyword">return</span> zepto<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> selector<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// $('div') 可能只有三个 div 节点，那么 $('div').add('p') 再三个 div 节点的基础上，增加三个 p 节点</span>
    <span class="token function-variable function">add</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector<span class="token punctuation">,</span>context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// uniq函数——数组去重，例如：用来将 [1,1,2,2,3,3] 替换为 [1,2,3]</span>
      <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token function">uniq</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">is</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 注意：这里只对 this[0] 第一个元素做判断了，其他的元素不管了</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> zepto<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> selector<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function-variable function">not</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> nodes<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 存储最后返回的结果</span>

      <span class="token comment">// 如果参数是函数</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFunction</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> selector<span class="token punctuation">.</span>call <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// 遍历对象的所有元素，对每个元素都执行传入的函数</span>
          <span class="token comment">// 当函数返回 false 时（即不符合函数的规则），则将当前元素push到结果中，等待返回</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">selector</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span> nodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// 如果参数不是函数</span>
      <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 为 excludes 赋值</span>
        <span class="token keyword">var</span> excludes <span class="token operator">=</span> 
          <span class="token comment">// 如果 selector 是字符串（css选择器），则用filter过滤，将结果存储到 excludes 中</span>
          <span class="token keyword">typeof</span> selector <span class="token operator">==</span> <span class="token string">'string'</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token punctuation">:</span>
          <span class="token comment">// 如果 selector 不是字符串</span>
          <span class="token comment">// 如果是数组或者对象数组（并且 selector.item 是函数？？？），则生成数组，赋值给 excludes</span>
          <span class="token punctuation">(</span><span class="token function">likeArray</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>selector<span class="token punctuation">.</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> 
          <span class="token comment">// 否则直接生成 zepto 对象，赋值给 excludes</span>
            <span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>

        <span class="token comment">// 至此，excludes 中就存储了通过 selector 查找出来的元素</span>

        <span class="token comment">// [].forEach 是ES5的新特性</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// 取出 excludes 中不包含的元素，push到结果中</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>excludes<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> nodes<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 返回最后的结果，用 $ 封装</span>
      <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function-variable function">has</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 经过 filter 函数处理，返回的是一个处理后的值</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">isObject</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token operator">?</span>
          <span class="token comment">// 如果 seletor 是 object（可能是elem节点），则用 $.contains 判断</span>
          $<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> selector<span class="token punctuation">)</span> <span class="token punctuation">:</span>
          <span class="token comment">// 否则（selector是css选择字符串）则返回find后的size（如果 size === 0 即相当于返回 false）</span>
          <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

          <span class="token comment">// $.fn.find 在下文定义</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">eq</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 取出指定index的元素</span>
      <span class="token comment">// 可支持 -1、0、1、2 ……</span>
      <span class="token keyword">return</span> idx <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span> <span class="token operator">+</span> idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">first</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> el <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token comment">// 不是 object 则直接返回</span>
      <span class="token comment">// 是 object 类型，则用 $ 封装 （因为时刻都要支持链式操作！！！）</span>
      <span class="token keyword">return</span> el <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">?</span> el <span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">last</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> el <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
      <span class="token keyword">return</span> el <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isObject</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">?</span> el <span class="token punctuation">:</span> <span class="token function">$</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">find</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// result 存储返回结果</span>
      <span class="token keyword">var</span> result<span class="token punctuation">,</span> $<span class="token keyword">this</span> <span class="token operator">=</span> <span class="token keyword">this</span>

      <span class="token comment">// 如果没有参数，就返回一个空的 zepto 对象</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>selector<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      <span class="token comment">// 如果selector是对象</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> selector <span class="token operator">==</span> <span class="token string">'object'</span><span class="token punctuation">)</span>
        result <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">var</span> node <span class="token operator">=</span> <span class="token keyword">this</span>
          <span class="token keyword">return</span> emptyArray<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">parent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>parent<span class="token punctuation">,</span> node<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// 如果 selector 不是对象（即是css选择器）：</span>

      <span class="token comment">// 如果只有一个元素，则使用 qsa 判断，结果经过 $ 封装后赋值给 result</span>
      <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>zepto<span class="token punctuation">.</span><span class="token function">qsa</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> selector<span class="token punctuation">)</span><span class="token punctuation">)</span>

      <span class="token comment">// 如果有多个元素，则使用 map 遍历所有元素，使用 qsa 针对每个元素判断，符合条件即返回（map将返回包含符合条件的元素的新数组，并 $ 封装，支持链式操作！！）</span>
      <span class="token keyword">else</span> result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> zepto<span class="token punctuation">.</span><span class="token function">qsa</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> selector<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
      
      <span class="token comment">// 返回最终结果</span>
      <span class="token keyword">return</span> result
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 从元素本身开始，逐级向上级元素匹配，并返回最先匹配selector的元素</span>
    <span class="token function-variable function">closest</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> node <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> collection <span class="token operator">=</span> <span class="token boolean">false</span>

      <span class="token comment">// 如果 selector 是对象，则用 $ 封装后，赋值给 collection</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> selector <span class="token operator">==</span> <span class="token string">'object'</span><span class="token punctuation">)</span> collection <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span>

      <span class="token keyword">while</span> <span class="token punctuation">(</span>
        <span class="token comment">// while循环的判断条件：</span>
        <span class="token comment">// 第一，node有值（node一开始被赋值为对象的第一个元素）</span>
        <span class="token comment">// 第二，collection有值（传入的selector是对象）则collection包含node；collection无值（传入的selector是字符串，css选择），则node满足selector条件</span>
        <span class="token comment">// 满足第一个条件，不满足第二条件，则循环继续（node试图赋值为node.parentNode）；否则，循环跳出（说明已经找到了符合条件的父节点）</span>
        node <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span>
                    collection <span class="token operator">?</span> collection<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token punctuation">:</span> zepto<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> selector<span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
      <span class="token punctuation">)</span>
        <span class="token comment">// node赋值成 node.parentNode</span>
        <span class="token comment">// 前提条件是：node != context &amp;&amp; node 不是 document，如果是这两个条件之一，那就不继续赋值</span>
        node <span class="token operator">=</span> node <span class="token operator">!==</span> context <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isDocument</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> node<span class="token punctuation">.</span>parentNode
      
      <span class="token comment">// 返回最终结果</span>
      <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 获取对象集合每个元素所有的祖先元素。 $('h1').parents() =&gt; [&lt;div#container&gt;, &lt;body&gt;, &lt;html&gt;]</span>
    <span class="token function-variable function">parents</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> ancestors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nodes <span class="token operator">=</span> <span class="token keyword">this</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>nodes<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment">// 可能需要执行多次 while 循环</span>
        <span class="token comment">// 每次执行 $.map 函数都会对 nodes 重新赋值，然后再判断是否需要继续循环</span>
        <span class="token comment">// 因为要获取每个元素的所有祖先元素，所以要多次循环</span>
        nodes <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>nodes<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// 使用 $.map（返回符合条件的元素的新数组，并用 $ 封装）遍历所有元素</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>node <span class="token operator">=</span> node<span class="token punctuation">.</span>parentNode<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isDocument</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> ancestors<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 将符合条件的元素push到结果中</span>
            <span class="token comment">// 条件：不能是 document，结果中元素不能重复。否则不执行push</span>
            ancestors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>

            <span class="token comment">// 返回的 node ，将拼接出新数组，重新复制给 nodes，然后试图继续执行 while 循环</span>
            <span class="token keyword">return</span> node
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// 如果css选择器参数给出，过滤出符合条件的元素</span>
      <span class="token keyword">return</span> <span class="token function">filtered</span><span class="token punctuation">(</span>ancestors<span class="token punctuation">,</span> selector<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 获取对象集合中每个元素的直接父元素。如果css选择器参数给出。过滤出符合条件的元素。</span>
    <span class="token function-variable function">parent</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// pluck 函数在下文定义</span>
      <span class="token comment">// parent 函数，只获取第一级父节点即可</span>
      <span class="token keyword">return</span> <span class="token function">filtered</span><span class="token punctuation">(</span><span class="token function">uniq</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pluck</span><span class="token punctuation">(</span><span class="token string">'parentNode'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> selector<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 获得每个匹配元素集合元素的直接子元素，可通过 selector 过滤</span>
    <span class="token function-variable function">children</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">filtered</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">children</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  selector
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 获得每个匹配元素集合元素的子元素，包括文字和注释节点</span>
    <span class="token function-variable function">contents</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>childNodes<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 获取对象集合中所有元素的兄弟节点，可通过 selector 过滤</span>
    <span class="token function-variable function">siblings</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">filtered</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i<span class="token punctuation">,</span> el</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 获取兄弟节点</span>
        <span class="token keyword">return</span> <span class="token function">filter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token function">children</span><span class="token punctuation">(</span>el<span class="token punctuation">.</span>parentNode<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> child<span class="token operator">!==</span>el <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span> selector<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">empty</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">''</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// `pluck` is borrowed from Prototype.js</span>
    <span class="token function-variable function">pluck</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">property</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 获取自定义属性，返回值，拼接数组</span>
      <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> el<span class="token punctuation">[</span>property<span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">show</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 返回当前对象，保证可链式操作</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        
        <span class="token comment">// 第一步，针对内联样式，将 none 改为空字符串，如 &lt;p id=&quot;p2&quot; style=&quot;display:none;&quot;&gt;p2&lt;/p&gt;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">==</span> <span class="token string">&quot;none&quot;</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>

        <span class="token comment">// 第二步，针对css样式，如果是 none 则修改为默认的显示样式</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getComputedStyle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span><span class="token string">&quot;display&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token function">defaultDisplay</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span>

        <span class="token comment">// show 方法是为了显示对象，而对象隐藏的方式有两种：内联样式 或 css样式</span>
        <span class="token comment">// this.style.display 只能获取内联样式的值（获取属性值）</span>
        <span class="token comment">// getComputedStyle(this, '').getPropertyValue(&quot;display&quot;) 可以获取内联、css样式的值（获取 renderTree 的值）</span>
        <span class="token comment">// 因此，这两步都要做判断，</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">replaceWith</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newContent</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 先在前面插入，然后将当前对象移除</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>newContent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">wrap</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">structure</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 是否是函数</span>
      <span class="token keyword">var</span> func <span class="token operator">=</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>structure<span class="token punctuation">)</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>func<span class="token punctuation">)</span>
        <span class="token keyword">var</span> dom   <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>structure<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// 何时用 clone ？</span>
            <span class="token comment">// 第一，dom.parentNode 说明 dom 在文档结构中，不 clone 就会被移动</span>
            <span class="token comment">// 第二，this.length &gt; 1 说明当前对象有多个元素，每个元素都要添加，所有要clone</span>
            clone <span class="token operator">=</span> dom<span class="token punctuation">.</span>parentNode <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span>

      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 借用 wrapAll 方法来做包装</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">wrapAll</span><span class="token punctuation">(</span>
          func <span class="token operator">?</span> <span class="token function">structure</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">:</span>
            clone <span class="token operator">?</span> dom<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> dom
        <span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 在所有匹配元素外面包一个单独的结构</span>
    <span class="token function-variable function">wrapAll</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">structure</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 先将 structure 插入到文档结构</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>structure <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span>structure<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">var</span> children
        <span class="token comment">// drill down to the inmost element</span>
        <span class="token comment">// 通过循环，将 structure 重新赋值为当前 structure 的最深处的一个子元素 </span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>children <span class="token operator">=</span> structure<span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> structure <span class="token operator">=</span> children<span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment">// 将所有子元素都包裹进 structure</span>
        <span class="token function">$</span><span class="token punctuation">(</span>structure<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 返回当前对象</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">wrapInner</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">structure</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 是否是函数</span>
      <span class="token keyword">var</span> func <span class="token operator">=</span> <span class="token function">isFunction</span><span class="token punctuation">(</span>structure<span class="token punctuation">)</span>

      <span class="token comment">// 返回对象自身，保证链式操作</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> contents <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token function">contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// 是函数，即获取函数执行的返回结果；否则直接用 structure 参数</span>
            dom  <span class="token operator">=</span> func <span class="token operator">?</span> <span class="token function">structure</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">:</span> structure

        <span class="token comment">// 如果当前元素有内容，则通过内容 wrapAll。无内容，则直接用自身的 append 增加</span>
        contents<span class="token punctuation">.</span>length <span class="token operator">?</span> contents<span class="token punctuation">.</span><span class="token function">wrapAll</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span> <span class="token punctuation">:</span> self<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">unwrap</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 通过 this.parent() 获取每个元素的父节点（集合）</span>
      <span class="token comment">// 遍历这个父节点的集合</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 将当前父节点替换为它的子节点</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// 返回对象自身，保证链式操作</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">clone</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 通过 this.map 循环对象，</span>
      <span class="token comment">// 针对每个元素都返回它的clone         这个 this 和前面的 this 不一样</span>
      <span class="token comment">// 返回新数组（用 $ 封装）</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">hide</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">&quot;display&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 切换显示和隐藏</span>
    <span class="token function-variable function">toggle</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">setting</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">/*
        @setting
        true : 强制切换为 show
        false : 强制切换为 hide
      */</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> el <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

        <span class="token comment">// 条件判断：</span>
        <span class="token comment">// 如果 setting === undefined 则看 el.css(&quot;display&quot;) == &quot;none&quot;</span>
        <span class="token comment">// 如果 setting !== undefined 则看 !!setting</span>
        <span class="token punctuation">;</span><span class="token punctuation">(</span>setting <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> el<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">&quot;display&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;none&quot;</span> <span class="token punctuation">:</span> setting<span class="token punctuation">)</span> <span class="token operator">?</span> 
        el<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token comment">// 如果 true 则显示</span>
        el<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 如果 false 则隐藏</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 借助 previousElementSibling 属性</span>
    <span class="token function-variable function">prev</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pluck</span><span class="token punctuation">(</span><span class="token string">'previousElementSibling'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>selector <span class="token operator">||</span> <span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 借助 nextElementSibling 属性</span>
    <span class="token function-variable function">next</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">selector</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">pluck</span><span class="token punctuation">(</span><span class="token string">'nextElementSibling'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>selector <span class="token operator">||</span> <span class="token string">'*'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">html</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> 

        <span class="token comment">// 情况1：有参数，赋值，并返回自身</span>
        <span class="token number">0</span> <span class="token keyword">in</span> arguments <span class="token operator">?</span> 
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">var</span> originHtml <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML
          <span class="token comment">// 传入的 html 参数允许是一个字符串，也允许是一个函数</span>
          <span class="token comment">// 通过 funcArg 函数：</span>
          <span class="token comment">//  1.如果 html 是字符串，则返回html</span>
          <span class="token comment">//  2.如果 html 是函数，则执行执行函数（传入 idx、originHtml），返回函数执行结果</span>
          <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span> <span class="token function">funcArg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> html<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> originHtml<span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>

        <span class="token comment">/*
          插播：
          function funcArg(context, arg, idx, payload) {
            return isFunction(arg) ? arg.call(context, idx, payload) : arg
          }
        */</span>

        <span class="token comment">// 情况2：无参数，取值</span>
        <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">in</span> <span class="token keyword">this</span> <span class="token operator">?</span> 
          <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerHTML <span class="token punctuation">:</span> <span class="token comment">// 直接取第一个元素的 innerHTML</span>
          <span class="token keyword">null</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">text</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> 

        <span class="token comment">// 情况1：有参数，赋值，并返回自身</span>
        <span class="token number">0</span> <span class="token keyword">in</span> arguments <span class="token operator">?</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// funcArg的应用，和html方法中一样</span>
          <span class="token keyword">var</span> newText <span class="token operator">=</span> <span class="token function">funcArg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> text<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>textContent<span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>textContent <span class="token operator">=</span> newText <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">''</span> <span class="token punctuation">:</span> <span class="token string">''</span><span class="token operator">+</span>newText
        <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>

        <span class="token comment">// 情况2：无参数，取值</span>
        <span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">in</span> <span class="token keyword">this</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>textContent <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">)</span>  <span class="token comment">// 直接借用 textContent 属性</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">attr</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> result

      <span class="token keyword">return</span> 

        <span class="token comment">// 情况1：无第二个参数，读取值（读取值只能读取第一个元素的值）</span>
        <span class="token punctuation">(</span><span class="token keyword">typeof</span> name <span class="token operator">==</span> <span class="token string">'string'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">in</span> arguments<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span>
        <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nodeType <span class="token operator">!==</span> <span class="token number">1</span> <span class="token operator">?</span> <span class="token keyword">undefined</span> <span class="token punctuation">:</span>
          <span class="token comment">/*
            注释：
            this[0]是一个DOM节点，有『属性』也有『特性』
              result = this[0].getAttribute(name) 试图获取 DOM节点属性
              name in this[0] 判断是不是js对象的属性
            然后，该返回哪一个就返回哪一个
          */</span>
          <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>result <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> name <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> 
          <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token punctuation">:</span> 
          result
        <span class="token punctuation">)</span> <span class="token punctuation">:</span>

        <span class="token comment">// 情况2：有第二个参数，设置值（针对每个元素设置值）</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>nodeType <span class="token operator">!==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

          <span class="token comment">// 传入的参数可能是一个对象集合</span>
          <span class="token comment">// 此时，是不是应该放在『情况1』当中？？？此时，value根本没有用啊？？？</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> name<span class="token punctuation">)</span> <span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> name<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>

          <span class="token comment">// 传入的不是对象，即设置一个单一的属性。</span>
          <span class="token comment">// 但是，这里的 value 参数可以是一个函数</span>
          <span class="token comment">// funcArg 即处理了 value 是函数和非函数的两种情况</span>
          <span class="token keyword">else</span> <span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> <span class="token function">funcArg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">removeAttr</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
          <span class="token keyword">this</span><span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>
            <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">attribute</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
              <span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> attribute<span class="token punctuation">)</span>  <span class="token comment">// 将属性设置为空，setAttribute会移除属性</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> 
            <span class="token keyword">this</span> <span class="token comment">// 改参数将成为 forEach 中函数的this</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 读取、设置属性（js对象的属性）</span>
    <span class="token function-variable function">prop</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// propMap 中存储的：key是html中的属性名称，value是js对象中的属性名称</span>
      <span class="token comment">// 例如，html中的 &quot;class&quot; 在DOM对象中，就需要使用 &quot;className&quot; 这个名字读取，同理于：for  maxlength  cellspacing 等等</span>
      name <span class="token operator">=</span> propMap<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">||</span> name

      <span class="token comment">/*
        上文定义：
        propMap = {
          'tabindex': 'tabIndex',
          'readonly': 'readOnly',
          'for': 'htmlFor',
          'class': 'className',
          'maxlength': 'maxLength',
          'cellspacing': 'cellSpacing',
          'cellpadding': 'cellPadding',
          'rowspan': 'rowSpan',
          'colspan': 'colSpan',
          'usemap': 'useMap',
          'frameborder': 'frameBorder',
          'contenteditable': 'contentEditable'
        }
      */</span>
      
      <span class="token keyword">return</span> 

        <span class="token comment">// 有第二个参数，设置属性</span>
        <span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">in</span> arguments<span class="token punctuation">)</span> <span class="token operator">?</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// 设置属性值，funcArg处理函数或者非函数</span>
          <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">funcArg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>

        <span class="token comment">// 无第二个参数，读取属性（读取第一个元素的）</span>
        <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 前面加上 'data-' 通过 attr 设置或者读取</span>
    <span class="token function-variable function">data</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">/*
        上文定义：
        capitalRE = /([A-Z])/g,  //大写字母
      */</span>

      <span class="token comment">//      前面加上 'data-'               将 'A' 替换为 '-a'</span>
      <span class="token keyword">var</span> attrName <span class="token operator">=</span> <span class="token string">'data-'</span> <span class="token operator">+</span> name<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>capitalRE<span class="token punctuation">,</span> <span class="token string">'-$1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">in</span> arguments<span class="token punctuation">)</span> <span class="token operator">?</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span>attrName<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">:</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span>attrName<span class="token punctuation">)</span>

      <span class="token keyword">return</span> data <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token function">deserializeValue</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">undefined</span>

      <span class="token comment">/*
        上文定义的，deserializeValue 函数的作用是：

        // 将字符串变成响应的对象或者值，例如源代码的注释：
        // &quot;true&quot;  =&gt; true
        // &quot;false&quot; =&gt; false
        // &quot;null&quot;  =&gt; null
        // &quot;42&quot;    =&gt; 42
        // &quot;42.5&quot;  =&gt; 42.5
        // &quot;08&quot;    =&gt; &quot;08&quot;
        // JSON    =&gt; parse if valid
        // String  =&gt; self
      */</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">val</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> 

        <span class="token comment">// 有参数，设置值</span>
        <span class="token number">0</span> <span class="token keyword">in</span> arguments <span class="token operator">?</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// 遍历每个元素，直接对 value 属性赋值</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token function">funcArg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>

        <span class="token comment">// 无参数，读取值</span>
        <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
           <span class="token comment">// 如果元素是 &lt;select multiple&gt; 多选列表</span>
           <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>multiple <span class="token operator">?</span>
           <span class="token comment">// 返回所有选中的option的值的数组</span>
           <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'option'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selected <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pluck</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span> <span class="token punctuation">:</span>

                   <span class="token comment">/*
                      上文定义：
                      pluck: function(property){
                        return $.map(this, function(el){ return el[property] })
                      },
                   */</span>

           <span class="token comment">// 如果不是，直接获取 value</span>
           <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value
          <span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 获取、设置元素的 offset</span>
    <span class="token function-variable function">offset</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">coordinates</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 如果有 coordinates 参数，设置坐标值，并返回当前对象</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>coordinates<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> $<span class="token keyword">this</span> <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// 支持函数（传入 $this.offset() 做参数）和非函数</span>
            coords <span class="token operator">=</span> <span class="token function">funcArg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> coordinates<span class="token punctuation">,</span> index<span class="token punctuation">,</span> $<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// 找到最近的 “relative”, “absolute” or “fixed” 的祖先元素，并获取它的 offset()</span>
            parentOffset <span class="token operator">=</span> $<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">offsetParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// left 和 top 需要去掉定位的祖先元素的 left、top 值</span>
            props <span class="token operator">=</span> <span class="token punctuation">{</span>
              top<span class="token punctuation">:</span>  coords<span class="token punctuation">.</span>top  <span class="token operator">-</span> parentOffset<span class="token punctuation">.</span>top<span class="token punctuation">,</span>
              left<span class="token punctuation">:</span> coords<span class="token punctuation">.</span>left <span class="token operator">-</span> parentOffset<span class="token punctuation">.</span>left
            <span class="token punctuation">}</span>

        <span class="token comment">// static时，设置 top、left是无效的</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'position'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'static'</span><span class="token punctuation">)</span> props<span class="token punctuation">[</span><span class="token string">'position'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'relative'</span>

        <span class="token comment">// 通过 css 赋值</span>
        $<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// 当前对象是空，则返回 null</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">null</span>

      <span class="token comment">// 如果没有 coordinates 参数，则返回第一个元素的坐标值</span>
      <span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">/*
        elem.getBoundingClientRect() 返回一个对象，
        包含元素的 top bottom left right width height 的值
        但是这个 top、bottom、left、right 是相对于浏览器窗口的距离，而不是页面的边界
        （注意，elem.getBoundingClientRect()在IE低版本浏览器有2px的兼容问题）

        window.pageXOffset 和 window.pageYOffset 可获取网页滚动的距离，
        IE低版本需要用 document.body.scrollLeft 和 document.body.scrollTop 兼容
      */</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        left<span class="token punctuation">:</span> obj<span class="token punctuation">.</span>left <span class="token operator">+</span> window<span class="token punctuation">.</span>pageXOffset<span class="token punctuation">,</span>
        top<span class="token punctuation">:</span> obj<span class="token punctuation">.</span>top <span class="token operator">+</span> window<span class="token punctuation">.</span>pageYOffset<span class="token punctuation">,</span>
        width<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 设置、获取 css</span>
    <span class="token function-variable function">css</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">property<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

      <span class="token comment">// 只有一个参数，获取第一个元素的样式</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> computedStyle<span class="token punctuation">,</span> element <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>element<span class="token punctuation">)</span> <span class="token keyword">return</span>  <span class="token comment">// 如果第一个元素无值，直接返回。否则继续</span>

        <span class="token comment">// 获取元素的计算后的样式</span>
        computedStyle <span class="token operator">=</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> property <span class="token operator">==</span> <span class="token string">'string'</span><span class="token punctuation">)</span>
          <span class="token comment">// 情况1，参数为字符串形式</span>
          <span class="token comment">// 先从elem内联样式获取（element.style），此时需要 camelize(property) 转换，如将 background-color 变为 backgroundColor</span>
          <span class="token comment">// 如果未找到，则从css样式获取 computedStyle.getPropertyValue(property) </span>
          <span class="token comment">// （重要）注释：elem.style 只能获取元素设置的内联样式、不能获取css样式；而 getComputedStyle 可获取内联、css样式。</span>
          <span class="token keyword">return</span> element<span class="token punctuation">.</span>style<span class="token punctuation">[</span><span class="token function">camelize</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">||</span> computedStyle<span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isArray</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 情况2，参数为数组形式（注意，此时 isObject 情况尚未判断）</span>
          <span class="token keyword">var</span> props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
          $<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>property<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            props<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>style<span class="token punctuation">[</span><span class="token function">camelize</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">||</span> computedStyle<span class="token punctuation">.</span><span class="token function">getPropertyValue</span><span class="token punctuation">(</span>prop<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> props  <span class="token comment">// 返回一个对象</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 其他情况：有两个参数、property是对象</span>
      <span class="token keyword">var</span> css <span class="token operator">=</span> <span class="token string">''</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">type</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 情况1，property 是字符串，设置单个样式</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span>
          <span class="token comment">// 如果value参数是 '' null undefined 则移除这个css样式</span>
          <span class="token comment">// 注：此计算只适用于内联样式的删除，对 css 样式无效，因为它只通过 this.style.removeProperty 计算，而 this.style 获取不到css样式</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">removeProperty</span><span class="token punctuation">(</span><span class="token function">dasherize</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span>
          <span class="token comment">// value有正常值，将 css 生成一个字符串（如 'font-size:20px'）等待赋值给内联样式</span>
          <span class="token comment">// maybeAddPx(property, value) 需要增加 px 的增加上</span>
          css <span class="token operator">=</span> <span class="token function">dasherize</span><span class="token punctuation">(</span>property<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">maybeAddPx</span><span class="token punctuation">(</span>property<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 情况2，property 是对象（此时就不管第二个参数是什么了，不用第二个参数），一次性设置多个样式</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> property<span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>property<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token comment">// 如果对象属性值是 '' null undefined 则移除这个css样式，同理，只针对内联样式</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span><span class="token function">removeProperty</span><span class="token punctuation">(</span><span class="token function">dasherize</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">else</span>
            <span class="token comment">// 否则，给 css 赋值一个字符串，多样式属性用 ; 隔开</span>
            css <span class="token operator">+=</span> <span class="token function">dasherize</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> <span class="token function">maybeAddPx</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> property<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">';'</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 针对每个元素，设置内联样式（this.style.cssText可获取、设置内联样式）</span>
      <span class="token comment">// 最后返回自身</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>cssText <span class="token operator">+=</span> <span class="token string">';'</span> <span class="token operator">+</span> css <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">/*
        上文定义：
        // 将 lineHeight 转换为 line-height 格式
        function dasherize(str) {
          return str.replace(/::/g, '/')
                    .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')
                    .replace(/([a-z\d])([A-Z])/g, '$1_$2')
                    .replace(/_/g, '-')
                    .toLowerCase()
        }
      */</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 获取一个元素的索引值（从0开始计数）。当elemen参数没有给出时，返回当前元素在兄弟节点中的位置</span>
    <span class="token function-variable function">index</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">/*
        上文定义：
        $.fn.indexOf: emptyArray.indexOf
      */</span>

      <span class="token comment">// 其实 this 本身就是一个数组，数组本身就有 indexOf ，为何还要上文的这个赋值呢？</span>
      <span class="token comment">// 因为上文中，this.__proto__ 修改了，不是 Array.prototype 了，也就没有 indexOf 方法了</span>
      <span class="token comment">// 因此要手动赋值，需要将数组常用的方法在重新赋值给 $.fn.indexOf</span>

      <span class="token keyword">return</span> element <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">children</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">hasClass</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span>
      <span class="token keyword">return</span> emptyArray<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// this 就是 classRE(name) 的返回值（返回一个正则）</span>
        <span class="token comment">// function className(node, value){...} 获取或者设置elem的className</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token function">className</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token function">classRE</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>

      <span class="token comment">// array.some(callback,[ thisObject]); 只要数组中一项符合callback要求，即返回true</span>

      <span class="token comment">/*
        // 上文定义 classCache = {}
        function classRE(name) {
          return name in classCache ?
                 classCache[name] : 
                 (classCache[name] = new RegExp('(^|\\s)' + name + '(\\s|$)'))

          // classCache 存储的数据是这样的：
          // {
          //   abc: /(^|\s)abc(\s|$)/,  // 能匹配 'abc' 或 ' abc ' 或 ' abc' 或 'abc '
          //   xyz: /(^|\s)abc(\s|$)/,
          //   ...
          // }
        }
      */</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">addClass</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span>

      <span class="token comment">// 针对所有元素都添加className，最终返回本身</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 说明当前元素不是 DOM node</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">'className'</span> <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

        <span class="token comment">// classList 是一开始就定义的空变量</span>
        classList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment">// 获取元素的 clasname      // 支持传入函数</span>
        <span class="token keyword">var</span> cls <span class="token operator">=</span> <span class="token function">className</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> newName <span class="token operator">=</span> <span class="token function">funcArg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> cls<span class="token punctuation">)</span>
        <span class="token comment">// 把要赋值的值，按照空白分组，遍历</span>
        newName<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\s+/g</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">klass</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// 把当前元素不存在的class，push到classlist中</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasClass</span><span class="token punctuation">(</span>klass<span class="token punctuation">)</span><span class="token punctuation">)</span> classList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>klass<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token comment">// 如果classlist有数据，则为当前元素赋值最新的class值（现有的classname和新的classname拼接）</span>
        classList<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> <span class="token function">className</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> cls <span class="token operator">+</span> <span class="token punctuation">(</span>cls <span class="token operator">?</span> <span class="token string">&quot; &quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> classList<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">removeClass</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 针对所有元素都移除className，最终返回本身</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 说明当前元素不是 DOM node</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">'className'</span> <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

        <span class="token comment">// 如果参数空，则移除元素的所有class</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">className</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>

        <span class="token comment">// 获取现有的classname</span>
        classList <span class="token operator">=</span> <span class="token function">className</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token comment">// （可以传入函数）遍历新的classname字符串</span>
        <span class="token function">funcArg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> classList<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\s+/g</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">klass</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// classRE(klass) 返回一个正则，匹配 'classname' 或 ' classname ' 或 ' classname' 或 'classname '</span>
          <span class="token comment">// 针对传入的classname字符串，对每个符合条件的classname，都替换为 ' '（即删除了）</span>
          classList <span class="token operator">=</span> classList<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token function">classRE</span><span class="token punctuation">(</span>klass<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// 对整理好的classname，重新赋值给当前元素</span>
        <span class="token function">className</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> classList<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">toggleClass</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> when</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// when 参数相当于一个条件：</span>
      <span class="token comment">// 如果 when === true 则单纯执行 addClass</span>
      <span class="token comment">// 如果 when === false 则单纯执行 removeClass</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>name<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//                   name 可接收函数，可以是空白分割开来的多个classname</span>
        <span class="token keyword">var</span> $<span class="token keyword">this</span> <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> names <span class="token operator">=</span> <span class="token function">funcArg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> <span class="token function">className</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">// 用空白分割开多个class</span>
        names<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex">/\s+/g</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">klass</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// 如果有 when 参数，则只通过when参数判断，true则只执行addClass，false则只执行removeClass</span>
          <span class="token comment">// 如果没有 when 参数，则判断元素有没有该class，有则移除，没有则添加</span>
          <span class="token punctuation">(</span>when <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">?</span> <span class="token operator">!</span>$<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">hasClass</span><span class="token punctuation">(</span>klass<span class="token punctuation">)</span> <span class="token punctuation">:</span> when<span class="token punctuation">)</span> <span class="token operator">?</span>
            $<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span>klass<span class="token punctuation">)</span> <span class="token punctuation">:</span> $<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span>klass<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">scrollTop</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span>

      <span class="token comment">// 普通elem有 scrollTop 属性，可以获取或者设置top值</span>
      <span class="token comment">// window对象没有 scrollTop 属性，通过 pageYOffset 获取，通过 scrollTo() 赋值</span>

      <span class="token keyword">var</span> hasScrollTop <span class="token operator">=</span> <span class="token string">'scrollTop'</span> <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token comment">// value 无值，获取 top</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> hasScrollTop <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>scrollTop <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pageYOffset
      <span class="token comment">// value 有值，设置 top</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>hasScrollTop <span class="token operator">?</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scrollTop <span class="token operator">=</span> value <span class="token punctuation">}</span> <span class="token punctuation">:</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scrollX<span class="token punctuation">,</span> value<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>   <span class="token comment">// window.scrollX 获取横向滚动值</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">scrollLeft</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">var</span> hasScrollLeft <span class="token operator">=</span> <span class="token string">'scrollLeft'</span> <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> hasScrollLeft <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>scrollLeft <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>pageXOffset
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>hasScrollLeft <span class="token operator">?</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scrollLeft <span class="token operator">=</span> value <span class="token punctuation">}</span> <span class="token punctuation">:</span>
        <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">scrollTo</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>scrollY<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>   <span class="token comment">// window.scrollX 获取纵向滚动值</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">position</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token keyword">return</span>

      <span class="token keyword">var</span> elem <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// Get *real* offsetParent</span>
        offsetParent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">offsetParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 找到第一个定位过的祖先元素 “relative”, “absolute” or “fixed”</span>
        <span class="token comment">// Get correct offsets</span>
        offset       <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 获取自身的offset</span>
        parentOffset <span class="token operator">=</span> rootNodeRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>offsetParent<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">{</span> top<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> left<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">:</span> offsetParent<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 获取定位祖先元素的offset（ body、html直接设置 top:0;left:0 ）</span>
      <span class="token comment">// 上文定义： rootNodeRE = /^(?:body|html)$/i,</span>

      <span class="token comment">// 去掉当前元素的 margin 宽度</span>
      <span class="token comment">// Subtract element margins</span>
      <span class="token comment">// note: when an element has margin: auto the offsetLeft and marginLeft</span>
      <span class="token comment">// are the same in Safari causing offset.left to incorrectly be 0</span>
      offset<span class="token punctuation">.</span>top  <span class="token operator">-=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span> <span class="token function">$</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'margin-top'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span>
      offset<span class="token punctuation">.</span>left <span class="token operator">-=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span> <span class="token function">$</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'margin-left'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span>

      <span class="token comment">// 增加父元素的 border 宽度</span>
      <span class="token comment">// Add offsetParent borders</span>
      parentOffset<span class="token punctuation">.</span>top  <span class="token operator">+=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span> <span class="token function">$</span><span class="token punctuation">(</span>offsetParent<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'border-top-width'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span>
      parentOffset<span class="token punctuation">.</span>left <span class="token operator">+=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span> <span class="token function">$</span><span class="token punctuation">(</span>offsetParent<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">'border-left-width'</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token number">0</span>

      <span class="token comment">// Subtract the two offsets</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        top<span class="token punctuation">:</span>  offset<span class="token punctuation">.</span>top  <span class="token operator">-</span> parentOffset<span class="token punctuation">.</span>top<span class="token punctuation">,</span>
        left<span class="token punctuation">:</span> offset<span class="token punctuation">.</span>left <span class="token operator">-</span> parentOffset<span class="token punctuation">.</span>left
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">offsetParent</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 通过 this.map 遍历当前对象所有元素，进行计算，然后拼接新的数组，并返回。保证链式操作</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>offsetParent <span class="token operator">||</span> document<span class="token punctuation">.</span>body  <span class="token comment">// elem.offsetParent 可返回最近的改元素最近的已经定位的父元素</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>rootNodeRE<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">$</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span><span class="token string">&quot;position&quot;</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">&quot;static&quot;</span><span class="token punctuation">)</span>
          <span class="token comment">// 如果获取的parent不是null、不是body或html、而且position==static</span>
          <span class="token comment">// 则继续向上查找 offsetParent、大不了找到 body 为止</span>
          parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>offsetParent

        <span class="token comment">// 最后返回改元素</span>
        <span class="token keyword">return</span> parent
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// for now</span>
  $<span class="token punctuation">.</span>fn<span class="token punctuation">.</span>detach <span class="token operator">=</span> $<span class="token punctuation">.</span>fn<span class="token punctuation">.</span>remove

  <span class="token comment">// Generate the `width` and `height` functions</span>
  <span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token string">'width'</span><span class="token punctuation">,</span> <span class="token string">'height'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dimension</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 将 width height 变为  Width Height</span>
    <span class="token keyword">var</span> dimensionProperty <span class="token operator">=</span>
      dimension<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/./</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">m</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

    $<span class="token punctuation">.</span>fn<span class="token punctuation">[</span>dimension<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> offset<span class="token punctuation">,</span> el <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

      <span class="token comment">// 情况1，无参数，获取第一个元素的值</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">isWindow</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">?</span> el<span class="token punctuation">[</span><span class="token string">'inner'</span> <span class="token operator">+</span> dimensionProperty<span class="token punctuation">]</span> <span class="token punctuation">:</span>  <span class="token comment">// window.innerHeight</span>
        <span class="token function">isDocument</span><span class="token punctuation">(</span>el<span class="token punctuation">)</span> <span class="token operator">?</span> el<span class="token punctuation">.</span>documentElement<span class="token punctuation">[</span><span class="token string">'scroll'</span> <span class="token operator">+</span> dimensionProperty<span class="token punctuation">]</span> <span class="token punctuation">:</span>  <span class="token comment">// document.documentElement.scrollHeight</span>
        <span class="token punctuation">(</span>offset <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> offset<span class="token punctuation">[</span>dimension<span class="token punctuation">]</span>  <span class="token comment">// this.offset().width</span>

      <span class="token comment">// 情况2，有参数，设置所有元素的值</span>
      <span class="token keyword">else</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">idx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        el <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token comment">// 通过 css() 方法设置，支持传入函数</span>
        el<span class="token punctuation">.</span><span class="token function">css</span><span class="token punctuation">(</span>dimension<span class="token punctuation">,</span> <span class="token function">funcArg</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> idx<span class="token punctuation">,</span> el<span class="token punctuation">[</span>dimension<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 针对当前元素、遍历子元素，都执行 fun 函数</span>
  <span class="token keyword">function</span> <span class="token function">traverseNode</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> fun</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fun</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> len <span class="token operator">=</span> node<span class="token punctuation">.</span>childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token function">traverseNode</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> fun<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 上文定义 adjacencyOperators = [ 'after', 'prepend', 'before', 'append' ],</span>
  
  <span class="token comment">// Generate the `after`, `prepend`, `before`, `append`,</span>
  <span class="token comment">// `insertAfter`, `insertBefore`, `appendTo`, and `prependTo` methods.</span>
  adjacencyOperators<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">operator<span class="token punctuation">,</span> operatorIndex</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> inside <span class="token operator">=</span> operatorIndex <span class="token operator">%</span> <span class="token number">2</span> <span class="token comment">//=&gt; prepend, append</span>

    $<span class="token punctuation">.</span>fn<span class="token punctuation">[</span>operator<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// arguments can be nodes, arrays of nodes, Zepto objects and HTML strings</span>
      <span class="token keyword">var</span> argType<span class="token punctuation">,</span> nodes <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            argType <span class="token operator">=</span> <span class="token function">type</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
            <span class="token keyword">return</span> argType <span class="token operator">==</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">||</span> argType <span class="token operator">==</span> <span class="token string">&quot;array&quot;</span> <span class="token operator">||</span> arg <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span>
              arg <span class="token punctuation">:</span> zepto<span class="token punctuation">.</span><span class="token function">fragment</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          parent<span class="token punctuation">,</span> copyByClone <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>nodes<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token keyword">this</span>

      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        parent <span class="token operator">=</span> inside <span class="token operator">?</span> target <span class="token punctuation">:</span> target<span class="token punctuation">.</span>parentNode

        <span class="token comment">// convert all methods to a &quot;before&quot; operation</span>
        target <span class="token operator">=</span> operatorIndex <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> target<span class="token punctuation">.</span>nextSibling <span class="token punctuation">:</span>
                 operatorIndex <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> target<span class="token punctuation">.</span>firstChild <span class="token punctuation">:</span>
                 operatorIndex <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> target <span class="token punctuation">:</span>
                 <span class="token keyword">null</span>

        <span class="token keyword">var</span> parentInDocument <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">,</span> parent<span class="token punctuation">)</span>

        nodes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>copyByClone<span class="token punctuation">)</span> node <span class="token operator">=</span> node<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
          <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>parent<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

          parent<span class="token punctuation">.</span><span class="token function">insertBefore</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> target<span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>parentInDocument<span class="token punctuation">)</span> <span class="token function">traverseNode</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">el</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>el<span class="token punctuation">.</span>nodeName <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> el<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'SCRIPT'</span> <span class="token operator">&amp;&amp;</span>
               <span class="token punctuation">(</span><span class="token operator">!</span>el<span class="token punctuation">.</span>type <span class="token operator">||</span> el<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'text/javascript'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>el<span class="token punctuation">.</span>src<span class="token punctuation">)</span>
              window<span class="token punctuation">[</span><span class="token string">'eval'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> el<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// after    =&gt; insertAfter</span>
    <span class="token comment">// prepend  =&gt; prependTo</span>
    <span class="token comment">// before   =&gt; insertBefore</span>
    <span class="token comment">// append   =&gt; appendTo</span>
    $<span class="token punctuation">.</span>fn<span class="token punctuation">[</span>inside <span class="token operator">?</span> operator<span class="token operator">+</span><span class="token string">'To'</span> <span class="token punctuation">:</span> <span class="token string">'insert'</span><span class="token operator">+</span><span class="token punctuation">(</span>operatorIndex <span class="token operator">?</span> <span class="token string">'Before'</span> <span class="token punctuation">:</span> <span class="token string">'After'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">$</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">[</span>operator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  zepto<span class="token punctuation">.</span><span class="token class-name">Z</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> $<span class="token punctuation">.</span>fn

  <span class="token comment">// Export internal API functions in the `$.zepto` namespace</span>
  zepto<span class="token punctuation">.</span>uniq <span class="token operator">=</span> uniq
  zepto<span class="token punctuation">.</span>deserializeValue <span class="token operator">=</span> deserializeValue
  $<span class="token punctuation">.</span>zepto <span class="token operator">=</span> zepto

  <span class="token keyword">return</span> $
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

window<span class="token punctuation">.</span>Zepto <span class="token operator">=</span> Zepto
window<span class="token punctuation">.</span>$ <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>$ <span class="token operator">=</span> Zepto<span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br><span class="line-number">381</span><br><span class="line-number">382</span><br><span class="line-number">383</span><br><span class="line-number">384</span><br><span class="line-number">385</span><br><span class="line-number">386</span><br><span class="line-number">387</span><br><span class="line-number">388</span><br><span class="line-number">389</span><br><span class="line-number">390</span><br><span class="line-number">391</span><br><span class="line-number">392</span><br><span class="line-number">393</span><br><span class="line-number">394</span><br><span class="line-number">395</span><br><span class="line-number">396</span><br><span class="line-number">397</span><br><span class="line-number">398</span><br><span class="line-number">399</span><br><span class="line-number">400</span><br><span class="line-number">401</span><br><span class="line-number">402</span><br><span class="line-number">403</span><br><span class="line-number">404</span><br><span class="line-number">405</span><br><span class="line-number">406</span><br><span class="line-number">407</span><br><span class="line-number">408</span><br><span class="line-number">409</span><br><span class="line-number">410</span><br><span class="line-number">411</span><br><span class="line-number">412</span><br><span class="line-number">413</span><br><span class="line-number">414</span><br><span class="line-number">415</span><br><span class="line-number">416</span><br><span class="line-number">417</span><br><span class="line-number">418</span><br><span class="line-number">419</span><br><span class="line-number">420</span><br><span class="line-number">421</span><br><span class="line-number">422</span><br><span class="line-number">423</span><br><span class="line-number">424</span><br><span class="line-number">425</span><br><span class="line-number">426</span><br><span class="line-number">427</span><br><span class="line-number">428</span><br><span class="line-number">429</span><br><span class="line-number">430</span><br><span class="line-number">431</span><br><span class="line-number">432</span><br><span class="line-number">433</span><br><span class="line-number">434</span><br><span class="line-number">435</span><br><span class="line-number">436</span><br><span class="line-number">437</span><br><span class="line-number">438</span><br><span class="line-number">439</span><br><span class="line-number">440</span><br><span class="line-number">441</span><br><span class="line-number">442</span><br><span class="line-number">443</span><br><span class="line-number">444</span><br><span class="line-number">445</span><br><span class="line-number">446</span><br><span class="line-number">447</span><br><span class="line-number">448</span><br><span class="line-number">449</span><br><span class="line-number">450</span><br><span class="line-number">451</span><br><span class="line-number">452</span><br><span class="line-number">453</span><br><span class="line-number">454</span><br><span class="line-number">455</span><br><span class="line-number">456</span><br><span class="line-number">457</span><br><span class="line-number">458</span><br><span class="line-number">459</span><br><span class="line-number">460</span><br><span class="line-number">461</span><br><span class="line-number">462</span><br><span class="line-number">463</span><br><span class="line-number">464</span><br><span class="line-number">465</span><br><span class="line-number">466</span><br><span class="line-number">467</span><br><span class="line-number">468</span><br><span class="line-number">469</span><br><span class="line-number">470</span><br><span class="line-number">471</span><br><span class="line-number">472</span><br><span class="line-number">473</span><br><span class="line-number">474</span><br><span class="line-number">475</span><br><span class="line-number">476</span><br><span class="line-number">477</span><br><span class="line-number">478</span><br><span class="line-number">479</span><br><span class="line-number">480</span><br><span class="line-number">481</span><br><span class="line-number">482</span><br><span class="line-number">483</span><br><span class="line-number">484</span><br><span class="line-number">485</span><br><span class="line-number">486</span><br><span class="line-number">487</span><br><span class="line-number">488</span><br><span class="line-number">489</span><br><span class="line-number">490</span><br><span class="line-number">491</span><br><span class="line-number">492</span><br><span class="line-number">493</span><br><span class="line-number">494</span><br><span class="line-number">495</span><br><span class="line-number">496</span><br><span class="line-number">497</span><br><span class="line-number">498</span><br><span class="line-number">499</span><br><span class="line-number">500</span><br><span class="line-number">501</span><br><span class="line-number">502</span><br><span class="line-number">503</span><br><span class="line-number">504</span><br><span class="line-number">505</span><br><span class="line-number">506</span><br><span class="line-number">507</span><br><span class="line-number">508</span><br><span class="line-number">509</span><br><span class="line-number">510</span><br><span class="line-number">511</span><br><span class="line-number">512</span><br><span class="line-number">513</span><br><span class="line-number">514</span><br><span class="line-number">515</span><br><span class="line-number">516</span><br><span class="line-number">517</span><br><span class="line-number">518</span><br><span class="line-number">519</span><br><span class="line-number">520</span><br><span class="line-number">521</span><br><span class="line-number">522</span><br><span class="line-number">523</span><br><span class="line-number">524</span><br><span class="line-number">525</span><br><span class="line-number">526</span><br><span class="line-number">527</span><br><span class="line-number">528</span><br><span class="line-number">529</span><br><span class="line-number">530</span><br><span class="line-number">531</span><br><span class="line-number">532</span><br><span class="line-number">533</span><br><span class="line-number">534</span><br><span class="line-number">535</span><br><span class="line-number">536</span><br><span class="line-number">537</span><br><span class="line-number">538</span><br><span class="line-number">539</span><br><span class="line-number">540</span><br><span class="line-number">541</span><br><span class="line-number">542</span><br><span class="line-number">543</span><br><span class="line-number">544</span><br><span class="line-number">545</span><br><span class="line-number">546</span><br><span class="line-number">547</span><br><span class="line-number">548</span><br><span class="line-number">549</span><br><span class="line-number">550</span><br><span class="line-number">551</span><br><span class="line-number">552</span><br><span class="line-number">553</span><br><span class="line-number">554</span><br><span class="line-number">555</span><br><span class="line-number">556</span><br><span class="line-number">557</span><br><span class="line-number">558</span><br><span class="line-number">559</span><br><span class="line-number">560</span><br><span class="line-number">561</span><br><span class="line-number">562</span><br><span class="line-number">563</span><br><span class="line-number">564</span><br><span class="line-number">565</span><br><span class="line-number">566</span><br><span class="line-number">567</span><br><span class="line-number">568</span><br><span class="line-number">569</span><br><span class="line-number">570</span><br><span class="line-number">571</span><br><span class="line-number">572</span><br><span class="line-number">573</span><br><span class="line-number">574</span><br><span class="line-number">575</span><br><span class="line-number">576</span><br><span class="line-number">577</span><br><span class="line-number">578</span><br><span class="line-number">579</span><br><span class="line-number">580</span><br><span class="line-number">581</span><br><span class="line-number">582</span><br><span class="line-number">583</span><br><span class="line-number">584</span><br><span class="line-number">585</span><br><span class="line-number">586</span><br><span class="line-number">587</span><br><span class="line-number">588</span><br><span class="line-number">589</span><br><span class="line-number">590</span><br><span class="line-number">591</span><br><span class="line-number">592</span><br><span class="line-number">593</span><br><span class="line-number">594</span><br><span class="line-number">595</span><br><span class="line-number">596</span><br><span class="line-number">597</span><br><span class="line-number">598</span><br><span class="line-number">599</span><br><span class="line-number">600</span><br><span class="line-number">601</span><br><span class="line-number">602</span><br><span class="line-number">603</span><br><span class="line-number">604</span><br><span class="line-number">605</span><br><span class="line-number">606</span><br><span class="line-number">607</span><br><span class="line-number">608</span><br><span class="line-number">609</span><br><span class="line-number">610</span><br><span class="line-number">611</span><br><span class="line-number">612</span><br><span class="line-number">613</span><br><span class="line-number">614</span><br><span class="line-number">615</span><br><span class="line-number">616</span><br><span class="line-number">617</span><br><span class="line-number">618</span><br><span class="line-number">619</span><br><span class="line-number">620</span><br><span class="line-number">621</span><br><span class="line-number">622</span><br><span class="line-number">623</span><br><span class="line-number">624</span><br><span class="line-number">625</span><br><span class="line-number">626</span><br><span class="line-number">627</span><br><span class="line-number">628</span><br><span class="line-number">629</span><br><span class="line-number">630</span><br><span class="line-number">631</span><br><span class="line-number">632</span><br><span class="line-number">633</span><br><span class="line-number">634</span><br><span class="line-number">635</span><br><span class="line-number">636</span><br><span class="line-number">637</span><br><span class="line-number">638</span><br><span class="line-number">639</span><br><span class="line-number">640</span><br><span class="line-number">641</span><br><span class="line-number">642</span><br><span class="line-number">643</span><br><span class="line-number">644</span><br><span class="line-number">645</span><br><span class="line-number">646</span><br><span class="line-number">647</span><br><span class="line-number">648</span><br><span class="line-number">649</span><br><span class="line-number">650</span><br><span class="line-number">651</span><br><span class="line-number">652</span><br><span class="line-number">653</span><br><span class="line-number">654</span><br><span class="line-number">655</span><br><span class="line-number">656</span><br><span class="line-number">657</span><br><span class="line-number">658</span><br><span class="line-number">659</span><br><span class="line-number">660</span><br><span class="line-number">661</span><br><span class="line-number">662</span><br><span class="line-number">663</span><br><span class="line-number">664</span><br><span class="line-number">665</span><br><span class="line-number">666</span><br><span class="line-number">667</span><br><span class="line-number">668</span><br><span class="line-number">669</span><br><span class="line-number">670</span><br><span class="line-number">671</span><br><span class="line-number">672</span><br><span class="line-number">673</span><br><span class="line-number">674</span><br><span class="line-number">675</span><br><span class="line-number">676</span><br><span class="line-number">677</span><br><span class="line-number">678</span><br><span class="line-number">679</span><br><span class="line-number">680</span><br><span class="line-number">681</span><br><span class="line-number">682</span><br><span class="line-number">683</span><br><span class="line-number">684</span><br><span class="line-number">685</span><br><span class="line-number">686</span><br><span class="line-number">687</span><br><span class="line-number">688</span><br><span class="line-number">689</span><br><span class="line-number">690</span><br><span class="line-number">691</span><br><span class="line-number">692</span><br><span class="line-number">693</span><br><span class="line-number">694</span><br><span class="line-number">695</span><br><span class="line-number">696</span><br><span class="line-number">697</span><br><span class="line-number">698</span><br><span class="line-number">699</span><br><span class="line-number">700</span><br><span class="line-number">701</span><br><span class="line-number">702</span><br><span class="line-number">703</span><br><span class="line-number">704</span><br><span class="line-number">705</span><br><span class="line-number">706</span><br><span class="line-number">707</span><br><span class="line-number">708</span><br><span class="line-number">709</span><br><span class="line-number">710</span><br><span class="line-number">711</span><br><span class="line-number">712</span><br><span class="line-number">713</span><br><span class="line-number">714</span><br><span class="line-number">715</span><br><span class="line-number">716</span><br><span class="line-number">717</span><br><span class="line-number">718</span><br><span class="line-number">719</span><br><span class="line-number">720</span><br><span class="line-number">721</span><br><span class="line-number">722</span><br><span class="line-number">723</span><br><span class="line-number">724</span><br><span class="line-number">725</span><br><span class="line-number">726</span><br><span class="line-number">727</span><br><span class="line-number">728</span><br><span class="line-number">729</span><br><span class="line-number">730</span><br><span class="line-number">731</span><br><span class="line-number">732</span><br><span class="line-number">733</span><br><span class="line-number">734</span><br><span class="line-number">735</span><br><span class="line-number">736</span><br><span class="line-number">737</span><br><span class="line-number">738</span><br><span class="line-number">739</span><br><span class="line-number">740</span><br><span class="line-number">741</span><br><span class="line-number">742</span><br><span class="line-number">743</span><br><span class="line-number">744</span><br><span class="line-number">745</span><br><span class="line-number">746</span><br><span class="line-number">747</span><br><span class="line-number">748</span><br><span class="line-number">749</span><br><span class="line-number">750</span><br><span class="line-number">751</span><br><span class="line-number">752</span><br><span class="line-number">753</span><br><span class="line-number">754</span><br><span class="line-number">755</span><br><span class="line-number">756</span><br><span class="line-number">757</span><br><span class="line-number">758</span><br><span class="line-number">759</span><br><span class="line-number">760</span><br><span class="line-number">761</span><br><span class="line-number">762</span><br><span class="line-number">763</span><br><span class="line-number">764</span><br><span class="line-number">765</span><br><span class="line-number">766</span><br><span class="line-number">767</span><br><span class="line-number">768</span><br><span class="line-number">769</span><br><span class="line-number">770</span><br><span class="line-number">771</span><br><span class="line-number">772</span><br><span class="line-number">773</span><br><span class="line-number">774</span><br><span class="line-number">775</span><br><span class="line-number">776</span><br><span class="line-number">777</span><br><span class="line-number">778</span><br><span class="line-number">779</span><br><span class="line-number">780</span><br><span class="line-number">781</span><br><span class="line-number">782</span><br><span class="line-number">783</span><br><span class="line-number">784</span><br><span class="line-number">785</span><br><span class="line-number">786</span><br><span class="line-number">787</span><br><span class="line-number">788</span><br><span class="line-number">789</span><br><span class="line-number">790</span><br><span class="line-number">791</span><br><span class="line-number">792</span><br><span class="line-number">793</span><br><span class="line-number">794</span><br><span class="line-number">795</span><br><span class="line-number">796</span><br><span class="line-number">797</span><br><span class="line-number">798</span><br><span class="line-number">799</span><br><span class="line-number">800</span><br><span class="line-number">801</span><br><span class="line-number">802</span><br><span class="line-number">803</span><br><span class="line-number">804</span><br><span class="line-number">805</span><br><span class="line-number">806</span><br><span class="line-number">807</span><br><span class="line-number">808</span><br><span class="line-number">809</span><br><span class="line-number">810</span><br><span class="line-number">811</span><br><span class="line-number">812</span><br><span class="line-number">813</span><br><span class="line-number">814</span><br><span class="line-number">815</span><br><span class="line-number">816</span><br><span class="line-number">817</span><br><span class="line-number">818</span><br><span class="line-number">819</span><br><span class="line-number">820</span><br><span class="line-number">821</span><br><span class="line-number">822</span><br><span class="line-number">823</span><br><span class="line-number">824</span><br><span class="line-number">825</span><br><span class="line-number">826</span><br><span class="line-number">827</span><br><span class="line-number">828</span><br><span class="line-number">829</span><br><span class="line-number">830</span><br><span class="line-number">831</span><br><span class="line-number">832</span><br><span class="line-number">833</span><br><span class="line-number">834</span><br><span class="line-number">835</span><br><span class="line-number">836</span><br><span class="line-number">837</span><br><span class="line-number">838</span><br><span class="line-number">839</span><br><span class="line-number">840</span><br><span class="line-number">841</span><br><span class="line-number">842</span><br><span class="line-number">843</span><br><span class="line-number">844</span><br><span class="line-number">845</span><br><span class="line-number">846</span><br><span class="line-number">847</span><br><span class="line-number">848</span><br><span class="line-number">849</span><br><span class="line-number">850</span><br><span class="line-number">851</span><br><span class="line-number">852</span><br><span class="line-number">853</span><br><span class="line-number">854</span><br><span class="line-number">855</span><br><span class="line-number">856</span><br><span class="line-number">857</span><br><span class="line-number">858</span><br><span class="line-number">859</span><br><span class="line-number">860</span><br><span class="line-number">861</span><br><span class="line-number">862</span><br><span class="line-number">863</span><br><span class="line-number">864</span><br><span class="line-number">865</span><br><span class="line-number">866</span><br><span class="line-number">867</span><br><span class="line-number">868</span><br><span class="line-number">869</span><br><span class="line-number">870</span><br><span class="line-number">871</span><br><span class="line-number">872</span><br><span class="line-number">873</span><br><span class="line-number">874</span><br><span class="line-number">875</span><br><span class="line-number">876</span><br><span class="line-number">877</span><br><span class="line-number">878</span><br><span class="line-number">879</span><br><span class="line-number">880</span><br><span class="line-number">881</span><br><span class="line-number">882</span><br><span class="line-number">883</span><br><span class="line-number">884</span><br><span class="line-number">885</span><br><span class="line-number">886</span><br><span class="line-number">887</span><br><span class="line-number">888</span><br><span class="line-number">889</span><br><span class="line-number">890</span><br><span class="line-number">891</span><br><span class="line-number">892</span><br><span class="line-number">893</span><br><span class="line-number">894</span><br><span class="line-number">895</span><br><span class="line-number">896</span><br><span class="line-number">897</span><br><span class="line-number">898</span><br><span class="line-number">899</span><br><span class="line-number">900</span><br><span class="line-number">901</span><br><span class="line-number">902</span><br><span class="line-number">903</span><br><span class="line-number">904</span><br><span class="line-number">905</span><br><span class="line-number">906</span><br><span class="line-number">907</span><br><span class="line-number">908</span><br><span class="line-number">909</span><br><span class="line-number">910</span><br><span class="line-number">911</span><br><span class="line-number">912</span><br><span class="line-number">913</span><br><span class="line-number">914</span><br><span class="line-number">915</span><br><span class="line-number">916</span><br><span class="line-number">917</span><br><span class="line-number">918</span><br><span class="line-number">919</span><br><span class="line-number">920</span><br><span class="line-number">921</span><br><span class="line-number">922</span><br><span class="line-number">923</span><br><span class="line-number">924</span><br><span class="line-number">925</span><br><span class="line-number">926</span><br><span class="line-number">927</span><br><span class="line-number">928</span><br><span class="line-number">929</span><br><span class="line-number">930</span><br><span class="line-number">931</span><br><span class="line-number">932</span><br><span class="line-number">933</span><br><span class="line-number">934</span><br><span class="line-number">935</span><br><span class="line-number">936</span><br><span class="line-number">937</span><br><span class="line-number">938</span><br><span class="line-number">939</span><br><span class="line-number">940</span><br><span class="line-number">941</span><br><span class="line-number">942</span><br><span class="line-number">943</span><br><span class="line-number">944</span><br><span class="line-number">945</span><br><span class="line-number">946</span><br><span class="line-number">947</span><br><span class="line-number">948</span><br><span class="line-number">949</span><br><span class="line-number">950</span><br><span class="line-number">951</span><br><span class="line-number">952</span><br><span class="line-number">953</span><br><span class="line-number">954</span><br><span class="line-number">955</span><br><span class="line-number">956</span><br><span class="line-number">957</span><br><span class="line-number">958</span><br><span class="line-number">959</span><br><span class="line-number">960</span><br><span class="line-number">961</span><br><span class="line-number">962</span><br><span class="line-number">963</span><br><span class="line-number">964</span><br><span class="line-number">965</span><br><span class="line-number">966</span><br><span class="line-number">967</span><br><span class="line-number">968</span><br><span class="line-number">969</span><br><span class="line-number">970</span><br><span class="line-number">971</span><br><span class="line-number">972</span><br><span class="line-number">973</span><br><span class="line-number">974</span><br><span class="line-number">975</span><br><span class="line-number">976</span><br><span class="line-number">977</span><br><span class="line-number">978</span><br><span class="line-number">979</span><br><span class="line-number">980</span><br><span class="line-number">981</span><br><span class="line-number">982</span><br><span class="line-number">983</span><br><span class="line-number">984</span><br><span class="line-number">985</span><br><span class="line-number">986</span><br><span class="line-number">987</span><br><span class="line-number">988</span><br><span class="line-number">989</span><br><span class="line-number">990</span><br><span class="line-number">991</span><br><span class="line-number">992</span><br><span class="line-number">993</span><br><span class="line-number">994</span><br><span class="line-number">995</span><br><span class="line-number">996</span><br><span class="line-number">997</span><br><span class="line-number">998</span><br><span class="line-number">999</span><br><span class="line-number">1000</span><br><span class="line-number">1001</span><br><span class="line-number">1002</span><br><span class="line-number">1003</span><br><span class="line-number">1004</span><br><span class="line-number">1005</span><br><span class="line-number">1006</span><br><span class="line-number">1007</span><br><span class="line-number">1008</span><br><span class="line-number">1009</span><br><span class="line-number">1010</span><br><span class="line-number">1011</span><br><span class="line-number">1012</span><br><span class="line-number">1013</span><br><span class="line-number">1014</span><br><span class="line-number">1015</span><br><span class="line-number">1016</span><br><span class="line-number">1017</span><br><span class="line-number">1018</span><br><span class="line-number">1019</span><br><span class="line-number">1020</span><br><span class="line-number">1021</span><br><span class="line-number">1022</span><br><span class="line-number">1023</span><br><span class="line-number">1024</span><br><span class="line-number">1025</span><br><span class="line-number">1026</span><br><span class="line-number">1027</span><br><span class="line-number">1028</span><br><span class="line-number">1029</span><br><span class="line-number">1030</span><br><span class="line-number">1031</span><br><span class="line-number">1032</span><br><span class="line-number">1033</span><br><span class="line-number">1034</span><br><span class="line-number">1035</span><br><span class="line-number">1036</span><br><span class="line-number">1037</span><br><span class="line-number">1038</span><br><span class="line-number">1039</span><br><span class="line-number">1040</span><br><span class="line-number">1041</span><br><span class="line-number">1042</span><br><span class="line-number">1043</span><br><span class="line-number">1044</span><br><span class="line-number">1045</span><br><span class="line-number">1046</span><br><span class="line-number">1047</span><br><span class="line-number">1048</span><br><span class="line-number">1049</span><br><span class="line-number">1050</span><br><span class="line-number">1051</span><br><span class="line-number">1052</span><br><span class="line-number">1053</span><br><span class="line-number">1054</span><br><span class="line-number">1055</span><br><span class="line-number">1056</span><br><span class="line-number">1057</span><br><span class="line-number">1058</span><br><span class="line-number">1059</span><br><span class="line-number">1060</span><br><span class="line-number">1061</span><br><span class="line-number">1062</span><br><span class="line-number">1063</span><br><span class="line-number">1064</span><br><span class="line-number">1065</span><br><span class="line-number">1066</span><br><span class="line-number">1067</span><br><span class="line-number">1068</span><br><span class="line-number">1069</span><br><span class="line-number">1070</span><br><span class="line-number">1071</span><br><span class="line-number">1072</span><br><span class="line-number">1073</span><br><span class="line-number">1074</span><br><span class="line-number">1075</span><br><span class="line-number">1076</span><br><span class="line-number">1077</span><br><span class="line-number">1078</span><br><span class="line-number">1079</span><br><span class="line-number">1080</span><br><span class="line-number">1081</span><br><span class="line-number">1082</span><br><span class="line-number">1083</span><br><span class="line-number">1084</span><br><span class="line-number">1085</span><br><span class="line-number">1086</span><br><span class="line-number">1087</span><br><span class="line-number">1088</span><br><span class="line-number">1089</span><br><span class="line-number">1090</span><br><span class="line-number">1091</span><br><span class="line-number">1092</span><br><span class="line-number">1093</span><br><span class="line-number">1094</span><br><span class="line-number">1095</span><br><span class="line-number">1096</span><br><span class="line-number">1097</span><br><span class="line-number">1098</span><br><span class="line-number">1099</span><br><span class="line-number">1100</span><br><span class="line-number">1101</span><br><span class="line-number">1102</span><br><span class="line-number">1103</span><br><span class="line-number">1104</span><br><span class="line-number">1105</span><br><span class="line-number">1106</span><br><span class="line-number">1107</span><br><span class="line-number">1108</span><br><span class="line-number">1109</span><br><span class="line-number">1110</span><br><span class="line-number">1111</span><br><span class="line-number">1112</span><br><span class="line-number">1113</span><br><span class="line-number">1114</span><br><span class="line-number">1115</span><br><span class="line-number">1116</span><br><span class="line-number">1117</span><br><span class="line-number">1118</span><br><span class="line-number">1119</span><br><span class="line-number">1120</span><br><span class="line-number">1121</span><br><span class="line-number">1122</span><br><span class="line-number">1123</span><br><span class="line-number">1124</span><br><span class="line-number">1125</span><br><span class="line-number">1126</span><br><span class="line-number">1127</span><br><span class="line-number">1128</span><br><span class="line-number">1129</span><br><span class="line-number">1130</span><br><span class="line-number">1131</span><br><span class="line-number">1132</span><br><span class="line-number">1133</span><br><span class="line-number">1134</span><br><span class="line-number">1135</span><br><span class="line-number">1136</span><br><span class="line-number">1137</span><br><span class="line-number">1138</span><br><span class="line-number">1139</span><br><span class="line-number">1140</span><br><span class="line-number">1141</span><br><span class="line-number">1142</span><br><span class="line-number">1143</span><br><span class="line-number">1144</span><br><span class="line-number">1145</span><br><span class="line-number">1146</span><br><span class="line-number">1147</span><br><span class="line-number">1148</span><br><span class="line-number">1149</span><br><span class="line-number">1150</span><br><span class="line-number">1151</span><br><span class="line-number">1152</span><br><span class="line-number">1153</span><br><span class="line-number">1154</span><br><span class="line-number">1155</span><br><span class="line-number">1156</span><br><span class="line-number">1157</span><br><span class="line-number">1158</span><br><span class="line-number">1159</span><br><span class="line-number">1160</span><br><span class="line-number">1161</span><br><span class="line-number">1162</span><br><span class="line-number">1163</span><br><span class="line-number">1164</span><br><span class="line-number">1165</span><br><span class="line-number">1166</span><br><span class="line-number">1167</span><br><span class="line-number">1168</span><br><span class="line-number">1169</span><br><span class="line-number">1170</span><br><span class="line-number">1171</span><br><span class="line-number">1172</span><br><span class="line-number">1173</span><br><span class="line-number">1174</span><br><span class="line-number">1175</span><br><span class="line-number">1176</span><br><span class="line-number">1177</span><br><span class="line-number">1178</span><br><span class="line-number">1179</span><br><span class="line-number">1180</span><br><span class="line-number">1181</span><br><span class="line-number">1182</span><br><span class="line-number">1183</span><br><span class="line-number">1184</span><br><span class="line-number">1185</span><br><span class="line-number">1186</span><br><span class="line-number">1187</span><br><span class="line-number">1188</span><br><span class="line-number">1189</span><br><span class="line-number">1190</span><br><span class="line-number">1191</span><br><span class="line-number">1192</span><br><span class="line-number">1193</span><br><span class="line-number">1194</span><br><span class="line-number">1195</span><br><span class="line-number">1196</span><br><span class="line-number">1197</span><br><span class="line-number">1198</span><br><span class="line-number">1199</span><br><span class="line-number">1200</span><br><span class="line-number">1201</span><br><span class="line-number">1202</span><br><span class="line-number">1203</span><br><span class="line-number">1204</span><br><span class="line-number">1205</span><br><span class="line-number">1206</span><br><span class="line-number">1207</span><br><span class="line-number">1208</span><br><span class="line-number">1209</span><br><span class="line-number">1210</span><br><span class="line-number">1211</span><br><span class="line-number">1212</span><br><span class="line-number">1213</span><br><span class="line-number">1214</span><br><span class="line-number">1215</span><br><span class="line-number">1216</span><br><span class="line-number">1217</span><br><span class="line-number">1218</span><br><span class="line-number">1219</span><br><span class="line-number">1220</span><br><span class="line-number">1221</span><br><span class="line-number">1222</span><br><span class="line-number">1223</span><br><span class="line-number">1224</span><br><span class="line-number">1225</span><br><span class="line-number">1226</span><br><span class="line-number">1227</span><br><span class="line-number">1228</span><br><span class="line-number">1229</span><br><span class="line-number">1230</span><br><span class="line-number">1231</span><br><span class="line-number">1232</span><br><span class="line-number">1233</span><br><span class="line-number">1234</span><br><span class="line-number">1235</span><br><span class="line-number">1236</span><br><span class="line-number">1237</span><br><span class="line-number">1238</span><br><span class="line-number">1239</span><br><span class="line-number">1240</span><br><span class="line-number">1241</span><br><span class="line-number">1242</span><br><span class="line-number">1243</span><br><span class="line-number">1244</span><br><span class="line-number">1245</span><br><span class="line-number">1246</span><br><span class="line-number">1247</span><br><span class="line-number">1248</span><br><span class="line-number">1249</span><br><span class="line-number">1250</span><br><span class="line-number">1251</span><br><span class="line-number">1252</span><br><span class="line-number">1253</span><br><span class="line-number">1254</span><br><span class="line-number">1255</span><br><span class="line-number">1256</span><br><span class="line-number">1257</span><br><span class="line-number">1258</span><br><span class="line-number">1259</span><br><span class="line-number">1260</span><br><span class="line-number">1261</span><br><span class="line-number">1262</span><br><span class="line-number">1263</span><br><span class="line-number">1264</span><br><span class="line-number">1265</span><br><span class="line-number">1266</span><br><span class="line-number">1267</span><br><span class="line-number">1268</span><br><span class="line-number">1269</span><br><span class="line-number">1270</span><br><span class="line-number">1271</span><br><span class="line-number">1272</span><br><span class="line-number">1273</span><br><span class="line-number">1274</span><br><span class="line-number">1275</span><br><span class="line-number">1276</span><br><span class="line-number">1277</span><br><span class="line-number">1278</span><br><span class="line-number">1279</span><br><span class="line-number">1280</span><br><span class="line-number">1281</span><br><span class="line-number">1282</span><br><span class="line-number">1283</span><br><span class="line-number">1284</span><br><span class="line-number">1285</span><br><span class="line-number">1286</span><br><span class="line-number">1287</span><br><span class="line-number">1288</span><br><span class="line-number">1289</span><br><span class="line-number">1290</span><br><span class="line-number">1291</span><br><span class="line-number">1292</span><br><span class="line-number">1293</span><br><span class="line-number">1294</span><br><span class="line-number">1295</span><br><span class="line-number">1296</span><br><span class="line-number">1297</span><br><span class="line-number">1298</span><br><span class="line-number">1299</span><br><span class="line-number">1300</span><br><span class="line-number">1301</span><br><span class="line-number">1302</span><br><span class="line-number">1303</span><br><span class="line-number">1304</span><br><span class="line-number">1305</span><br><span class="line-number">1306</span><br><span class="line-number">1307</span><br><span class="line-number">1308</span><br><span class="line-number">1309</span><br><span class="line-number">1310</span><br><span class="line-number">1311</span><br><span class="line-number">1312</span><br><span class="line-number">1313</span><br><span class="line-number">1314</span><br><span class="line-number">1315</span><br><span class="line-number">1316</span><br><span class="line-number">1317</span><br><span class="line-number">1318</span><br><span class="line-number">1319</span><br><span class="line-number">1320</span><br><span class="line-number">1321</span><br><span class="line-number">1322</span><br><span class="line-number">1323</span><br><span class="line-number">1324</span><br><span class="line-number">1325</span><br><span class="line-number">1326</span><br><span class="line-number">1327</span><br><span class="line-number">1328</span><br><span class="line-number">1329</span><br><span class="line-number">1330</span><br><span class="line-number">1331</span><br><span class="line-number">1332</span><br><span class="line-number">1333</span><br><span class="line-number">1334</span><br><span class="line-number">1335</span><br><span class="line-number">1336</span><br><span class="line-number">1337</span><br><span class="line-number">1338</span><br><span class="line-number">1339</span><br><span class="line-number">1340</span><br><span class="line-number">1341</span><br><span class="line-number">1342</span><br><span class="line-number">1343</span><br><span class="line-number">1344</span><br><span class="line-number">1345</span><br><span class="line-number">1346</span><br><span class="line-number">1347</span><br><span class="line-number">1348</span><br><span class="line-number">1349</span><br><span class="line-number">1350</span><br><span class="line-number">1351</span><br><span class="line-number">1352</span><br><span class="line-number">1353</span><br><span class="line-number">1354</span><br><span class="line-number">1355</span><br><span class="line-number">1356</span><br><span class="line-number">1357</span><br><span class="line-number">1358</span><br><span class="line-number">1359</span><br><span class="line-number">1360</span><br><span class="line-number">1361</span><br><span class="line-number">1362</span><br><span class="line-number">1363</span><br><span class="line-number">1364</span><br><span class="line-number">1365</span><br><span class="line-number">1366</span><br><span class="line-number">1367</span><br><span class="line-number">1368</span><br><span class="line-number">1369</span><br><span class="line-number">1370</span><br><span class="line-number">1371</span><br><span class="line-number">1372</span><br><span class="line-number">1373</span><br><span class="line-number">1374</span><br><span class="line-number">1375</span><br><span class="line-number">1376</span><br><span class="line-number">1377</span><br><span class="line-number">1378</span><br><span class="line-number">1379</span><br><span class="line-number">1380</span><br><span class="line-number">1381</span><br><span class="line-number">1382</span><br><span class="line-number">1383</span><br><span class="line-number">1384</span><br><span class="line-number">1385</span><br><span class="line-number">1386</span><br><span class="line-number">1387</span><br><span class="line-number">1388</span><br><span class="line-number">1389</span><br><span class="line-number">1390</span><br><span class="line-number">1391</span><br><span class="line-number">1392</span><br><span class="line-number">1393</span><br><span class="line-number">1394</span><br><span class="line-number">1395</span><br><span class="line-number">1396</span><br><span class="line-number">1397</span><br><span class="line-number">1398</span><br><span class="line-number">1399</span><br><span class="line-number">1400</span><br><span class="line-number">1401</span><br><span class="line-number">1402</span><br><span class="line-number">1403</span><br><span class="line-number">1404</span><br><span class="line-number">1405</span><br><span class="line-number">1406</span><br><span class="line-number">1407</span><br><span class="line-number">1408</span><br><span class="line-number">1409</span><br><span class="line-number">1410</span><br><span class="line-number">1411</span><br><span class="line-number">1412</span><br><span class="line-number">1413</span><br><span class="line-number">1414</span><br><span class="line-number">1415</span><br><span class="line-number">1416</span><br><span class="line-number">1417</span><br><span class="line-number">1418</span><br><span class="line-number">1419</span><br><span class="line-number">1420</span><br><span class="line-number">1421</span><br><span class="line-number">1422</span><br><span class="line-number">1423</span><br><span class="line-number">1424</span><br><span class="line-number">1425</span><br><span class="line-number">1426</span><br><span class="line-number">1427</span><br><span class="line-number">1428</span><br><span class="line-number">1429</span><br><span class="line-number">1430</span><br><span class="line-number">1431</span><br><span class="line-number">1432</span><br><span class="line-number">1433</span><br><span class="line-number">1434</span><br><span class="line-number">1435</span><br><span class="line-number">1436</span><br><span class="line-number">1437</span><br><span class="line-number">1438</span><br><span class="line-number">1439</span><br><span class="line-number">1440</span><br><span class="line-number">1441</span><br><span class="line-number">1442</span><br><span class="line-number">1443</span><br><span class="line-number">1444</span><br><span class="line-number">1445</span><br><span class="line-number">1446</span><br><span class="line-number">1447</span><br><span class="line-number">1448</span><br><span class="line-number">1449</span><br><span class="line-number">1450</span><br><span class="line-number">1451</span><br><span class="line-number">1452</span><br><span class="line-number">1453</span><br><span class="line-number">1454</span><br><span class="line-number">1455</span><br><span class="line-number">1456</span><br><span class="line-number">1457</span><br><span class="line-number">1458</span><br><span class="line-number">1459</span><br><span class="line-number">1460</span><br><span class="line-number">1461</span><br><span class="line-number">1462</span><br><span class="line-number">1463</span><br><span class="line-number">1464</span><br><span class="line-number">1465</span><br><span class="line-number">1466</span><br><span class="line-number">1467</span><br><span class="line-number">1468</span><br><span class="line-number">1469</span><br><span class="line-number">1470</span><br><span class="line-number">1471</span><br><span class="line-number">1472</span><br><span class="line-number">1473</span><br><span class="line-number">1474</span><br><span class="line-number">1475</span><br><span class="line-number">1476</span><br><span class="line-number">1477</span><br><span class="line-number">1478</span><br><span class="line-number">1479</span><br><span class="line-number">1480</span><br><span class="line-number">1481</span><br><span class="line-number">1482</span><br><span class="line-number">1483</span><br><span class="line-number">1484</span><br><span class="line-number">1485</span><br><span class="line-number">1486</span><br><span class="line-number">1487</span><br><span class="line-number">1488</span><br><span class="line-number">1489</span><br><span class="line-number">1490</span><br><span class="line-number">1491</span><br><span class="line-number">1492</span><br><span class="line-number">1493</span><br><span class="line-number">1494</span><br><span class="line-number">1495</span><br><span class="line-number">1496</span><br><span class="line-number">1497</span><br><span class="line-number">1498</span><br><span class="line-number">1499</span><br><span class="line-number">1500</span><br><span class="line-number">1501</span><br><span class="line-number">1502</span><br><span class="line-number">1503</span><br><span class="line-number">1504</span><br><span class="line-number">1505</span><br><span class="line-number">1506</span><br><span class="line-number">1507</span><br><span class="line-number">1508</span><br><span class="line-number">1509</span><br><span class="line-number">1510</span><br><span class="line-number">1511</span><br><span class="line-number">1512</span><br><span class="line-number">1513</span><br><span class="line-number">1514</span><br><span class="line-number">1515</span><br><span class="line-number">1516</span><br><span class="line-number">1517</span><br><span class="line-number">1518</span><br><span class="line-number">1519</span><br><span class="line-number">1520</span><br><span class="line-number">1521</span><br><span class="line-number">1522</span><br><span class="line-number">1523</span><br><span class="line-number">1524</span><br><span class="line-number">1525</span><br><span class="line-number">1526</span><br><span class="line-number">1527</span><br><span class="line-number">1528</span><br><span class="line-number">1529</span><br><span class="line-number">1530</span><br><span class="line-number">1531</span><br><span class="line-number">1532</span><br><span class="line-number">1533</span><br><span class="line-number">1534</span><br><span class="line-number">1535</span><br><span class="line-number">1536</span><br><span class="line-number">1537</span><br><span class="line-number">1538</span><br><span class="line-number">1539</span><br><span class="line-number">1540</span><br><span class="line-number">1541</span><br><span class="line-number">1542</span><br><span class="line-number">1543</span><br><span class="line-number">1544</span><br><span class="line-number">1545</span><br><span class="line-number">1546</span><br><span class="line-number">1547</span><br><span class="line-number">1548</span><br><span class="line-number">1549</span><br><span class="line-number">1550</span><br><span class="line-number">1551</span><br><span class="line-number">1552</span><br><span class="line-number">1553</span><br><span class="line-number">1554</span><br><span class="line-number">1555</span><br><span class="line-number">1556</span><br><span class="line-number">1557</span><br><span class="line-number">1558</span><br><span class="line-number">1559</span><br><span class="line-number">1560</span><br><span class="line-number">1561</span><br><span class="line-number">1562</span><br><span class="line-number">1563</span><br><span class="line-number">1564</span><br><span class="line-number">1565</span><br><span class="line-number">1566</span><br><span class="line-number">1567</span><br><span class="line-number">1568</span><br><span class="line-number">1569</span><br><span class="line-number">1570</span><br><span class="line-number">1571</span><br><span class="line-number">1572</span><br><span class="line-number">1573</span><br><span class="line-number">1574</span><br><span class="line-number">1575</span><br><span class="line-number">1576</span><br><span class="line-number">1577</span><br><span class="line-number">1578</span><br><span class="line-number">1579</span><br><span class="line-number">1580</span><br><span class="line-number">1581</span><br><span class="line-number">1582</span><br><span class="line-number">1583</span><br><span class="line-number">1584</span><br><span class="line-number">1585</span><br><span class="line-number">1586</span><br><span class="line-number">1587</span><br><span class="line-number">1588</span><br><span class="line-number">1589</span><br><span class="line-number">1590</span><br><span class="line-number">1591</span><br><span class="line-number">1592</span><br><span class="line-number">1593</span><br><span class="line-number">1594</span><br><span class="line-number">1595</span><br><span class="line-number">1596</span><br><span class="line-number">1597</span><br><span class="line-number">1598</span><br><span class="line-number">1599</span><br><span class="line-number">1600</span><br><span class="line-number">1601</span><br><span class="line-number">1602</span><br><span class="line-number">1603</span><br><span class="line-number">1604</span><br><span class="line-number">1605</span><br><span class="line-number">1606</span><br><span class="line-number">1607</span><br><span class="line-number">1608</span><br><span class="line-number">1609</span><br><span class="line-number">1610</span><br><span class="line-number">1611</span><br><span class="line-number">1612</span><br><span class="line-number">1613</span><br><span class="line-number">1614</span><br><span class="line-number">1615</span><br><span class="line-number">1616</span><br><span class="line-number">1617</span><br><span class="line-number">1618</span><br><span class="line-number">1619</span><br><span class="line-number">1620</span><br><span class="line-number">1621</span><br><span class="line-number">1622</span><br><span class="line-number">1623</span><br><span class="line-number">1624</span><br><span class="line-number">1625</span><br><span class="line-number">1626</span><br><span class="line-number">1627</span><br><span class="line-number">1628</span><br><span class="line-number">1629</span><br><span class="line-number">1630</span><br><span class="line-number">1631</span><br><span class="line-number">1632</span><br><span class="line-number">1633</span><br><span class="line-number">1634</span><br><span class="line-number">1635</span><br><span class="line-number">1636</span><br><span class="line-number">1637</span><br><span class="line-number">1638</span><br><span class="line-number">1639</span><br><span class="line-number">1640</span><br><span class="line-number">1641</span><br><span class="line-number">1642</span><br><span class="line-number">1643</span><br><span class="line-number">1644</span><br><span class="line-number">1645</span><br><span class="line-number">1646</span><br><span class="line-number">1647</span><br><span class="line-number">1648</span><br><span class="line-number">1649</span><br><span class="line-number">1650</span><br><span class="line-number">1651</span><br><span class="line-number">1652</span><br><span class="line-number">1653</span><br><span class="line-number">1654</span><br><span class="line-number">1655</span><br><span class="line-number">1656</span><br><span class="line-number">1657</span><br><span class="line-number">1658</span><br><span class="line-number">1659</span><br><span class="line-number">1660</span><br><span class="line-number">1661</span><br><span class="line-number">1662</span><br><span class="line-number">1663</span><br><span class="line-number">1664</span><br><span class="line-number">1665</span><br><span class="line-number">1666</span><br><span class="line-number">1667</span><br><span class="line-number">1668</span><br><span class="line-number">1669</span><br><span class="line-number">1670</span><br><span class="line-number">1671</span><br><span class="line-number">1672</span><br><span class="line-number">1673</span><br><span class="line-number">1674</span><br><span class="line-number">1675</span><br><span class="line-number">1676</span><br><span class="line-number">1677</span><br><span class="line-number">1678</span><br><span class="line-number">1679</span><br><span class="line-number">1680</span><br><span class="line-number">1681</span><br><span class="line-number">1682</span><br><span class="line-number">1683</span><br><span class="line-number">1684</span><br><span class="line-number">1685</span><br><span class="line-number">1686</span><br><span class="line-number">1687</span><br><span class="line-number">1688</span><br><span class="line-number">1689</span><br><span class="line-number">1690</span><br><span class="line-number">1691</span><br><span class="line-number">1692</span><br><span class="line-number">1693</span><br><span class="line-number">1694</span><br><span class="line-number">1695</span><br><span class="line-number">1696</span><br><span class="line-number">1697</span><br><span class="line-number">1698</span><br><span class="line-number">1699</span><br><span class="line-number">1700</span><br><span class="line-number">1701</span><br><span class="line-number">1702</span><br><span class="line-number">1703</span><br><span class="line-number">1704</span><br><span class="line-number">1705</span><br><span class="line-number">1706</span><br><span class="line-number">1707</span><br><span class="line-number">1708</span><br><span class="line-number">1709</span><br><span class="line-number">1710</span><br><span class="line-number">1711</span><br><span class="line-number">1712</span><br><span class="line-number">1713</span><br><span class="line-number">1714</span><br><span class="line-number">1715</span><br><span class="line-number">1716</span><br><span class="line-number">1717</span><br><span class="line-number">1718</span><br><span class="line-number">1719</span><br><span class="line-number">1720</span><br><span class="line-number">1721</span><br><span class="line-number">1722</span><br><span class="line-number">1723</span><br><span class="line-number">1724</span><br><span class="line-number">1725</span><br><span class="line-number">1726</span><br><span class="line-number">1727</span><br><span class="line-number">1728</span><br><span class="line-number">1729</span><br><span class="line-number">1730</span><br><span class="line-number">1731</span><br><span class="line-number">1732</span><br><span class="line-number">1733</span><br></div></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/yanghcc/blog/edit/master/docs/note/zepto-src.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/4/2019, 2:47:22 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/note/snippets.html" class="prev">
          代码片段
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/blog/assets/js/app.bae4038b.js" defer></script><script src="/blog/assets/js/38.f6e289a7.js" defer></script>
  </body>
</html>
